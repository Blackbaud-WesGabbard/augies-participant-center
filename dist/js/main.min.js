(function(){angular.module("trPcApp",["ngRoute","ngSanitize","ngCookies","ui.bootstrap","cgBusy","pascalprecht.translate","textAngular","formly","formlyBootstrap","trPcControllers"]),angular.module("trPcControllers",[]),angular.module("trPcApp").constant("APP_INFO",{version:"1.0",rootPath:"../angular-teamraiser-participant-center/dist/"}),angular.module("trPcApp").run(["$rootScope","$window","APP_INFO",function(e,t,a){var r,n;return e.Math=t.Math,""!==(r=angular.element(document).find("[data-embed-root]")).data("app-version")&&(n=r.data("app-version")),n!==a.version&&console.warn("Angular TeamRaiser Participant Center: App version in HTML and JavaScript differ. Please confirm all files are up-to-date."),""!==r.data("api-key")&&(e.apiKey=r.data("api-key")),e.apiKey||new Error("Angular TeamRaiser Participant Center: No Luminate Online API Key is defined."),""!==r.data("site-shortname")&&(e.siteShortname=r.data("site-shortname")),""!==r.data("nonsecure-path")&&(e.nonsecurePath=r.data("nonsecure-path")),""!==r.data("secure-path")&&(e.securePath=r.data("secure-path")),luminateExtend?luminateExtend.init({apiKey:e.apiKey,path:{nonsecure:e.nonsecurePath,secure:e.securePath}}):new Error("Angular TeamRaiser Participant Center: No LuminateExtend available"),""!==r.data("fr-id")&&(e.frId=r.data("fr-id")),e.frId||new Error("Angular TeamRaiser Participant Center: No TeamRaiser ID is defined."),""!==r.data("locale")&&(e.locale=r.data("locale")),e.locale||(e.locale="en_US"),""!==r.data("cons-id")&&(e.consId=r.data("cons-id")),""!==r.data("auth-token")&&(e.authToken=r.data("auth-token")),e.socialSettings={appName:r.data("janrain-appname")||"",appUrl:"",providers:[],janrainEnabled:!1,janrainInitialized:!1,shareTitle:"",shareAction:"",shareMessage:"",shareId:"TR-"+e.frId,shareUrl:""}}]),angular.element(document).ready(function(){if(!angular.element(document).injector())return angular.bootstrap(document,["trPcApp"])}),angular.module("trPcApp").value("cgBusyDefaults",{message:"Loading ...",minDuration:500}),angular.module("trPcApp").config(["formlyConfigProvider","APP_INFO",function(e,t){return e.setType({name:"username",extends:"input",templateUrl:t.rootPath+"html/directive/formlyUsername.html",wrapper:["bootstrapLabel","bootstrapHasError"],defaultOptions:{templateOptions:{changePasswordLabel:"Change Password"}}}),e.setType({name:"datepicker",templateUrl:t.rootPath+"html/directive/formlyDatepicker.html",wrapper:["bootstrapLabel","bootstrapHasError"],defaultOptions:{ngModelAttrs:{dateDisabled:{attribute:"date-disabled"},customClass:{attribute:"custom-class"},showWeeks:{attribute:"show-weeks"},startingDay:{attribute:"starting-day"},initDate:{attribute:"init-date"},minMode:{attribute:"min-mode"},maxMode:{attribute:"max-mode"},formatDay:{attribute:"format-day"},formatMonth:{attribute:"format-month"},formatYear:{attribute:"format-year"},formatDayHeader:{attribute:"format-day-header"},formatDayTitle:{attribute:"format-day-title"},formatMonthTitle:{attribute:"format-month-title"},yearRange:{attribute:"year-range"},shortcutPropagation:{attribute:"shortcut-propagation"},datepickerPopup:{attribute:"datepicker-popup"},showButtonBar:{attribute:"show-button-bar"},currentText:{attribute:"current-text"},clearText:{attribute:"clear-text"},closeText:{attribute:"close-text"},closeOnDateSelection:{attribute:"close-on-date-selection"},datepickerAppendToBody:{attribute:"datepicker-append-to-body"},datepickerMode:{bound:"datepicker-mode"},minDate:{bound:"min-date"},maxDate:{bound:"max-date"}},templateOptions:{dateOptions:{format:"MM/dd/yyyy",initDate:new Date}}},controller:["$scope",function(e){return e.datepicker={},e.datepicker.opened=!1,e.datepicker.open=function(t){return e.datepicker.opened=!e.datepicker.opened}}]}),e.setType({name:"typeahead",template:'<input type="text" ng-model="model[options.key]" uib-typeahead="item for item in to.options | filter:$viewValue" class="form-control">',wrapper:["bootstrapLabel","bootstrapHasError"],defaultOptions:{ngModelAttrs:{ngModelOptions:{bound:"ng-model-options"},typeaheadAppendTo:{bound:"typeahead-append-to"},typeaheadAppendToBody:{bound:"typeahead-append-to-body"},typeaheadEditable:{bound:"typeahead-editable"},typeaheadFocusFirst:{bound:"typeahead-focus-first"},typeaheadFocusOnSelect:{attribute:"typeahead-focus-on-select"},typeaheadInputFormatter:{bound:"typeahead-input-formatter"},typeaheadIsOpen:{bound:"typeahead-is-open"},typeaheadLoading:{bound:"typeahead-loading"},typeaheadMinLength:{bound:"typeahead-min-length",value:0},typeaheadNoResults:{bound:"typeahead-no-results"},typeaheadShouldSelect:{bound:"typeahead-should-select"},typeaheadOnSelect:{bound:"typeahead-on-select"},typeaheadPopupTemplateUrl:{attribute:"typeahead-popup-template-url"},typeaheadSelectOnBlur:{bound:"typeahead-select-on-blur"},typeaheadSelectOnExact:{bound:"typeahead-select-on-exact"},typeaheadShowHint:{bound:"typeahead-show-hint"},typeaheadTemplateUrl:{attribute:"typeahead-template-url"},typeaheadWaitMs:{bound:"typeahead-wait-ms"}}}}),e.setType({name:"caption",template:'<div class="formly-form-caption" ng-bind-html="to.label"></div>',wrapper:["bootstrapHasError"]}),e.setType({name:"hidden",template:'<div class="formly-form-hidden"><input type="hidden" ng-model="model[options.key]"></div>'}),e.setType({name:"captcha",template:'<div class="formly-form-captcha"></div>'}),e}]),angular.module("trPcApp").config(["$routeProvider","APP_INFO",function(e,t){return e.when("/dashboard",{templateUrl:t.rootPath+"html/view/dashboard.html",controller:"DashboardViewCtrl"}).when("/enter-gifts",{templateUrl:t.rootPath+"html/view/enterGifts.html",controller:"EnterGiftsViewCtrl"}).when("/email",{redirectTo:"/email/compose"}).when("/email/compose/:messageType?/:messageId?",{templateUrl:t.rootPath+"html/view/emailCompose.html",controller:"EmailComposeViewCtrl"}).when("/email/message/:messageType",{redirectTo:"/email/message/:messageType/list"}).when("/email/message/:messageType/list",{templateUrl:t.rootPath+"html/view/emailMessageList.html",controller:"EmailMessageListViewCtrl"}).when("/email/contacts",{redirectTo:"/email/contacts/email_rpt_show_all/list"}).when("/email/contacts/:filter",{redirectTo:"/email/contacts/:filter/list"}).when("/email/contacts/:filter/list",{templateUrl:t.rootPath+"html/view/emailContactsList.html",controller:"EmailContactsListViewCtrl"}).when("/profile",{templateUrl:t.rootPath+"html/view/consProfile.html",controller:"ConsProfileViewCtrl"}).when("/profile/questions",{templateUrl:t.rootPath+"html/view/surveyQuestions.html",controller:"SurveyQuestionsViewCtrl"}).when("/profile/options",{templateUrl:t.rootPath+"html/view/eventOptions.html",controller:"EventOptionsViewCtrl"}).otherwise({redirectTo:function(){var e,t;return""!==(e=angular.element(document).find("[data-embed-root]")).data("pc-page")&&(t=e.data("pc-page")),"mtype"===t?"/email/compose":"/dashboard"}()})}]),angular.module("trPcApp").run(["$rootScope","$location","$route","$uibModal","$window","AuthService","TeamraiserEventService","TeamraiserRegistrationService","SocialShareService","APP_INFO",function(e,t,a,r,n,s,o,i,l,c){return e.scrollToTop=function(){var e;if(e=angular.element(document).find("[data-embed-root]"),angular.isElement(e))return e[0].scrollIntoView()},e.$on("$routeChangeStart",function(n,u,p){var m,d,g;return e.scrollToTop(),m=function(a){return e.$evalAsync(function(){return t.path(a)})},d=function(){var e;return""!==(e=t.path())&&e!==u.originalPath?m(u.originalPath):a.reload()},g=function(){if(!e.loginModal)return e.loginModal=r.open({scope:e,backdrop:"static",templateUrl:c.rootPath+"html/modal/login.html"})},e.teamraiserConfig?-1===e.teamraiserConfig?n.preventDefault():"true"!==e.teamraiserConfig.acceptingDonations&&"true"!==e.teamraiserConfig.acceptingRegistrations?n.preventDefault():e.consId?-1===e.consId?(n.preventDefault(),g()):e.authToken?e.participantRegistration?-1===e.participantRegistration?n.preventDefault():e.eventInfo?-1===e.eventInfo?n.preventDefault():e.socialSettings.janrainInitialized?"/profile/questions"===u.originalPath&&"true"!==e.teamraiserConfig.personalSurveyEditAllowed?m("/profile"):void 0:(n.preventDefault(),l.initJanrain().then(function(){return d()})):(n.preventDefault(),o.getTeamraiser().then(function(t){if(-1!==e.eventInfo)return d()})):(n.preventDefault(),i.getRegistration().then(function(){if(-1!==e.participantRegistration)return d()})):(n.preventDefault(),s.getAuthToken().then(function(){return d()})):(n.preventDefault(),s.getLoginState().then(function(){return-1===e.consId?g():a.reload()})):(n.preventDefault(),o.getConfig().then(function(){if(-1!==e.teamraiserConfig)return d()}))})}]),angular.module("trPcApp").config(["$translateProvider","APP_INFO",function(e,t){var a,r,n;return e.fallbackLanguage("en_US"),e.useSanitizeValueStrategy("escape"),a={type:"msgCat",bundle:"login_user",keys:["error_invalid_username_or_password","login_button_label","new_password","new_password_repeat","password_hint","reset_password_title","submit_button_label"]},n={type:"msgCat",bundle:"trpc",keys:["activity_followup_message_sent","add_contact_email_label","add_contact_first_name_label","add_contact_last_name_label","add_contact_submit_button","add_contacts_cancel_link","addressbookimport_header","addressbookimport_importcandidatecontacts_list_select_all_label_top","addressbookimport_importcandidatecontacts_list_select_label_top","addressbookimport_importcandidatecontacts_list_select_none_label_top","addressbookimport_selectcontacts_info","addressbookimport_selectcontacts_none_selected_failure","addressbookimport_selectsource_info_1","addressbookimport_thirdpartystatus_info","addressbookimport_tooltip_select_source_generic","addressbookimport_tooltip_select_source_gmail","addressbookimport_tooltip_select_source_yahoo","admin_newsfeed_header_h1","captains_message_edit_link","captains_message_empty","captains_message_header","captains_message_save_button","captains_save_failure","captains_save_success","chart_emails_sent_label","chart_gift_amount_label","class_cancel_link","class_next_button","class_or_label","company_page_content_label","company_page_shortcut_cancel","company_page_shortcut_edit","company_page_shortcut_edit2","company_page_shortcut_save","company_page_shortcut_save_failure","company_page_shortcut_save_success","company_progress_bar_title","company_report_teams_label","company_select_none","compose_current_layout_label","compose_delete_button_label","compose_message_label","compose_preview_button_label","compose_preview_send_label","compose_salutation_hint","compose_save_template_button_label","compose_send_button_label","compose_subject_label","compose_to_label","contact_add_failure_email","contact_add_failure_unknown","contact_add_success","contact_details_contact_info_hdr","contact_details_edit_info","contact_edit_address1_label","contact_edit_address2_label","contact_edit_cancel_link","contact_edit_city_label","contact_edit_country_label","contact_edit_email_label","contact_edit_first_name_label","contact_edit_last_name_label","contact_edit_save_button","contact_edit_state_label","contact_edit_zip_label","contact_no_name_label","contacts_acknowledge_contact_gift_no_email_body","contacts_acknowledge_gift_title_label","contacts_add_to_group","contacts_add_to_group_button","contacts_confirm_delete_body","contacts_confirm_delete_groups_body","contacts_confirm_delete_groups_header","contacts_confirm_delete_header","contacts_create_a_new_group","contacts_delete_button","contacts_delete_success","contacts_donations_label","contacts_email_all_button","contacts_email_opened_label","contacts_groups_all","contacts_import_contacts","contacts_label","contacts_page_visits_label","contacts_previous_amount_label","contacts_select_label","contacts_selected","contacts_sidebar_add_contact_header","contacts_warn_delete_failure_body","csv_upload_contacts","dashboard_company_cancel_label","dashboard_company_edit_label","dashboard_company_name_title","dashboard_company_null_label","dashboard_company_submit_label","dashboard_edit_company_list_label","dashboard_edit_company_name_label","dashboard_enter_gift_button","data_table_contacts_per_page","dialog_acknowledge_label","dialog_delete_label","dialog_save_label","donations_heading","donations_no_donations_found","drafts_confirm_delete_body","drafts_confirm_delete_header","drafts_drafts_label","drafts_no_drafts_found","email_compose_use_template_label","email_template_radio_custom_label","email_template_radio_other_label","email_template_radio_recruit_label","email_template_radio_solicit_label","email_template_radio_thanks_label","filter_email_rpt_show_donors","filter_email_rpt_show_ly_donors","filter_email_rpt_show_lybunt_donors","filter_email_rpt_show_ly_teammates","filter_email_rpt_show_ly_unreg_teammates","filter_email_rpt_show_never_emailed","filter_email_rpt_show_nondonors","filter_email_rpt_show_nondonors_followup","filter_email_rpt_show_nonteammates","filter_email_rpt_show_teammates","filter_email_rpt_show_unthanked_donors","gift_add_another_button_label","gift_add_button_label","gift_addl_options_label","gift_amount_label","gift_billing_city_label","gift_billing_first_name_label","gift_billing_last_name_label","gift_billing_state_label","gift_billing_street1_label","gift_billing_street2_label","gift_billing_zip_label","gift_check_number_label","gift_city_label","gift_confirm_delete_body","gift_confirm_delete_header","gift_credit_card_number_label","gift_credit_expiration_date_label","gift_credit_verification_code_label","gift_display_personal_page_label","gift_email_label","gift_first_name_label","gift_gift_category_label","gift_last_name_label","gift_payment_type_cash","gift_payment_type_check","gift_payment_type_credit","gift_payment_type_label","gift_payment_type_later","gift_recongition_name_label","gift_state_label","gift_street1_label","gift_street2_label","gift_submit_success","gift_zip_label","goal_edit_goal","goal_goal","hdr_profile_link","manage_membership_captain_first_name","manage_membership_captain_last_name","manage_membership_continue_button","manage_membership_find_team","manage_membership_join_team","manage_membership_join_team_password_label","manage_membership_join_team_radio_text","manage_membership_label","manage_membership_leave_team_explanation_text","manage_membership_leave_team_radio_text","manage_membership_search_button","manage_membership_search_failure","manage_membership_search_result_captain_label","manage_membership_search_result_company_label","manage_membership_search_results","manage_membership_team_company","manage_membership_team_name","manage_membership_team_search_results_count","manage_membership_team_search_results_found","manage_membership_team_search_results_hint","manage_team_captains_header","message_send_success","message_template_save_success","nav_manage_privacy_settings_link","nav_messaging","nav_overview","nav_public_page","nav_team_page","personal_page_privacy_prefix_desc","personal_page_privacy_private_desc","personal_page_privacy_private_label","personal_page_privacy_public_desc","personal_page_privacy_public_label","personal_page_privacy_save_success","personal_page_save","personal_page_shortcut_edit","personal_page_shortcut_save","personal_preview_close_label","privacy_settings_anonymous_option","privacy_settings_radio_label","privacy_settings_screenname_option","privacy_settings_standard_option","progress_bar_title","progress_team_progress","recent_activity_header","report_personal_donations_download","sent_message_date_label","sent_message_forward_label","sent_message_subject_label","sent_message_to_label","sent_no_sent_messages_found","sent_sent_message_label","sent_sent_messages_label","session_timeout_log_back_in","shortcut_save_failure","shortcut_save_success","social_share_link_text","subnav_edit_survey_responses","subnav_manage_captains","survey_save_failure","survey_save_responses_button","survey_save_success","team_donations_heading","team_edit_team_name_label","team_goal_edit_goal","team_goal_goal","team_page_permalink","team_page_shortcut_cancel","team_page_shortcut_edit","team_page_shortcut_edit2","team_page_shortcut_save","team_password_edit_label","team_report_team_donations_download","team_report_team_members_download","team_roster_heading","teampage_shortcut_save_failure","teampage_shortcut_save_success","what_next_add_contacts_header","what_next_followup_header","what_next_question","what_next_reach_out_header","what_next_send_email_header","what_next_send_thanks_header","what_next_set_goal_header","what_next_setup_your_personal_page_header"]},r={type:"file",prefix:t.rootPath+"translation/",suffix:".json"},e.useLoader("useMessageCatalog",{messages:[a,n,r]})}]),angular.module("trPcApp").config(["$uibModalProvider",function(e){return angular.extend(e.options,{windowClass:"ng-pc-modal"})}]),angular.module("trPcApp").factory("AuthService",["$rootScope","LuminateRESTService",function(e,t){return{getLoginState:function(){return t.consRequest("method=loginTest").then(function(t){var a;return e.consId=(null!=(a=t.data.loginResponse)?a.cons_id:void 0)||-1,t})},getAuthToken:function(){return t.consRequest("method=getLoginUrl").then(function(t){return e.authToken=t.data.getLoginUrlResponse.token,t})},login:function(a){var r;return r="method=login",a&&""!==a&&(r+="&"+a),t.consRequest(r).then(function(t){var a;return e.consId=(null!=(a=t.data.loginResponse)?a.cons_id:void 0)||-1,delete e.authToken,t})}}}]),angular.module("trPcApp").factory("ConstituentService",["LuminateRESTService",function(e){return{getUser:function(){return e.consRequest("method=getUser",!0).then(function(e){return e})},listUserFields:function(t){var a;return a="method=listUserFields",a+="&include_choices=true",t&&""!==t&&(a+="&"+t),e.consRequest(a).then(function(e){return e})},listUserFieldChoices:function(t){var a;return a="method=listUserFieldChoices&field=",t&&""!==t&&(a+=t),e.consRequest(a).then(function(e){return e})},update:function(t){var a;return a="method=update",t&&""!==t&&(a+="&"+t),e.consRequest(a,!0).then(function(e){return e})},changePassword:function(t){var a;return a="method=changePassword",t&&""!==t&&(a+="&"+t),e.consRequest(a,!0).then(function(e){return e})},logSocialShare:function(t){var a;return a="method=logSocialShare",t&&""!==t&&(a+="&"+t),e.consRequest(a,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("ContactService",["$rootScope","LuminateRESTService",function(e,t){return{addAddressBookContact:function(e){var a;return a="method=addAddressBookContact",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0).then(function(e){return e})},getAddressBookImportJobStatus:function(e){var a;return a="method=getAddressBookImportJobStatus",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0,!0).then(function(e){return e})},getAddressBookImportContacts:function(e){var a;return a="method=getAddressBookImportContacts",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0,!0).then(function(e){return e})},importAddressBookContacts:function(e){var a;return a="method=importAddressBookContacts",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0,!0).then(function(e){return e})},addAddressBookGroup:function(e){var a;return a="method=addAddressBookGroup",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0).then(function(e){return e})},addContactsToGroup:function(e){var a;return a="method=addContactsToGroup",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0).then(function(e){return e})},deleteAddressBookGroups:function(e){var a;return a="method=deleteAddressBookGroups",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0).then(function(e){return e})},deleteTeamraiserAddressBookContacts:function(e){var a;return a="method=deleteTeamraiserAddressBookContacts",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},updateTeamraiserAddressBookContact:function(e){var a;return a="method=updateTeamraiserAddressBookContact",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getAddressBookGroups:function(e){var a;return a="method=getAddressBookGroups",e&&""!==e&&(a+="&"+e),t.addressBookRequest(a,!0).then(function(e){return e})},getTeamraiserAddressBookFilters:function(e){var a;return a="method=getTeamraiserAddressBookFilters",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getTeamraiserAddressBookContacts:function(e){var a;return a="method=getTeamraiserAddressBookContacts",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getTeamraiserAddressBookContact:function(e){var a;return a="method=getTeamraiserAddressBookContact",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getTeamraiserAddressBookGroupContacts:function(e){var a;return a="method=getTeamraiserAddressBookGroupContacts",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getContactString:function(e){var t;return t="",e.firstName&&(t+=e.firstName),e.lastName&&(""!==t&&(t+=" "),t+=e.lastName),e.email&&(""!==t&&(t+=" "),t+="<"+e.email+">"),t},resetSelectedContacts:function(){return e.selectedContacts={contacts:[]}},getNumSelectedContacts:function(){var t;return(null!=(t=e.selectedContacts)?t.contacts:void 0)||this.resetSelectedContacts(),e.selectedContacts.contacts.length},isInSelectedContacts:function(t){var a;return a=!1,null!=t&&null!=t.id&&angular.forEach(e.selectedContacts.contacts,function(e){if(null!=e&&e.id===t.id)return a=!0}),a},addToSelectedContacts:function(t){return this.isInSelectedContacts(t)||e.selectedContacts.contacts.push(t),t},removeFromSelectedContacts:function(t){var a;return a=-1,null!=t&&null!=t.id&&(angular.forEach(e.selectedContacts.contacts,function(e,r){if(null!=e&&e.id===t.id)return a=r}),a>=0&&e.selectedContacts.contacts.splice(a,1)),t}}}]),angular.module("trPcApp").factory("ContentService",["LuminateRESTService",function(e){return{getMessageBundle:function(t){var a;return a="method=getMessageBundle",t&&""!==t&&(a+="&"+t),e.contentRequest(a,!1).then(function(e){return e})}}}]),angular.module("trPcApp").factory("useMessageCatalog",["$q","$http","ContentService",function(e,t,a){return function(r){var n,s,o,i,l,c,u,p;if(n=e.defer(),i=function(a){if(!a||!angular.isString(a.prefix||!angular.isString(a.suffix)))throw new Error("Couldn't load static file, no prefix or suffix specified");return t(angular.extend({url:[a.prefix,r.key,a.suffix].join(""),method:"GET",params:""},r.$http)).then(function(e){return e.data},function(){return e.reject(r.key)})},l=function(e){var t,r;if(!(null!=e?e.keys:void 0)||!angular.isArray(e.keys))throw new Error("Couldn't load message catalog bundle, no keys specified");return t="bundle=",(null!=e?e.bundle:void 0)?t+=e.bundle:t+="trpc",(null!=e?e.keys:void 0)&&angular.isArray(e.keys)&&(t+="&keys="+(null!=e&&null!=(r=e.keys)?r.toString():void 0)),a.getMessageBundle(t).then(function(e){var t,a,r,n,s,o,i,l;if(r={},l=function(e){if(e)return String(e).replace(/<[^>]+>/gm,"").replace(/&nbsp;/gm," ")},null!=e&&null!=(o=e.data)&&null!=(i=o.getMessageBundleResponse)?i.values:void 0)for(n=e.data.getMessageBundleResponse.values,angular.isArray(n)||(n=[n]),t=0,a=n.length;t<a;t++)r[(s=n[t]).key]=l(s.value);return r})},!((null!=r?r.messages:void 0)&&angular.isArray(r.messages)))throw new Error("Couldn't load messages using message catalog, no messages provided.");for(u=[],s=0,o=(p=r.messages).length;s<o;s++)switch((c=p[s]).type){case"file":u.push(i(c));break;case"msgCat":u.push(l(c));break;default:throw new Error("Unrecognized message.type: "+c.type)}return e.all(u).then(function(e){var t,a,r,s;for(r={},t=0,a=e.length;t<a;t++)s=e[t],angular.extend(r,s);return n.resolve(r)}),n.promise}}]),angular.module("trPcApp").factory("LocaleService",["$rootScope","$translate","LuminateRESTService",function(e,t,a){return{listSupportedLocales:function(){return a.contentRequest("method=listSupportedLocales",!0,!0).then(function(e){return e})},setLocale:function(a){return e.locale=a,t.use(a)}}}]),angular.module("trPcApp").factory("LuminateRESTService",["$rootScope","$q","$http","$timeout","$uibModal","APP_INFO",function(e,t,a,r,n,s){return{request:function(o,i,l,c){var u;return i?e.apiKey?(i+="&v=1.0&api_key="+e.apiKey+"&response_format=json&suppress_response_codes=true&ng_tr_pc_v="+s.version,l&&!e.authToken?new Error("Angular TeamRaiser Participant Center: No Luminate Online auth token is defined."):(l&&(i+="&auth="+e.authToken),c&&(i+="&fr_id="+e.frId+"&s_trID="+e.frId),e.locale&&(i+="&s_locale="+e.locale),a({method:"POST",url:o,data:i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(a){return a.data.errorResponse&&-1!==["3","5","14","2604"].indexOf(a.data.errorResponse.code)?(e.loginModal||(e.loginModal=n.open({scope:e,backdrop:"static",templateUrl:s.rootPath+"html/modal/login.html"})),t.reject()):a}))):(""!==(u=angular.element(document).find("[data-embed-root]")).data("api-key")&&(e.apiKey=u.data("api-key")),e.apiKey?this.request(o,i,l,c):(new Error("Angular TeamRaiser Participant Center: No Luminate Online API Key is defined."),r(this.request,500,!0,o,i,l,c))):new Error("Angular TeamRaiser Participant Center: API request for "+o+" with no requestData")},addressBookRequest:function(e,t){return this.request("CRAddressBookAPI",e,t,!1)},consRequest:function(e,t){return this.request("CRConsAPI",e,t,!1)},contentRequest:function(e,t){return this.request("CRContentAPI",e,t,!1)},teamraiserRequest:function(e,t,a){return this.request("CRTeamraiserAPI",e,t,a)}}}]),angular.module("trPcApp").factory("PageBuilderService",["$rootScope","$http","$q","$timeout","$document",function(e,t,a,r,n){return{getPageContent:function(r,n,s){var o,i;return e.pageBuilderCache||(e.pageBuilderCache={}),n&&e.pageBuilderCache[r]?((i=a.defer()).resolve(e.pageBuilderCache[r]),i.promise):(o="pagename=getPageBuilderPageContent&pgwrap=n",r&&(o+="&pb_page_name="+r),s&&(o+="&"+s),t({method:"GET",url:"SPageServer?"+o,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){if(r)return e.pageBuilderCache[r]=t,t}))},loadScript:function(e){var t,s,o;return t=a.defer(),s=n[0],o=s.createElement("script"),o.src=e,o.type="text/javascript",o.onload=function(e){return r(function(){return t.resolve(e)})},o.onreadystatechange=function(e){if(this.readyState&&("complete"===this.readyState||"loaded"===this.readyState))return r(function(){return t.resolve(e)})},o.onerror=function(e){return r(function(){return t.reject(e)})},s.body.appendChild(o),t.promise}}}]),angular.module("trPcApp").factory("SocialShareService",["$rootScope","$cookies","$window","ConstituentService","PageBuilderService","TeamraiserEventService",function(e,t,a,r,n,s){return{logShare:function(t,n){var s;return s="",s+="social_uid="+encodeURIComponent(t),s+="&social_site="+n,s+="&share_url="+encodeURIComponent(a.location.href),s+="&share_id="+encodeURIComponent(e.socialSettings.shareId),r.logSocialShare(s).then(function(e){return e})},activateJanrain:function(t,r){var n;if(e.socialSettings.janrainEnabled&&null!=a.janrain&&(null!=t?t.length:void 0))return n={message:e.socialSettings.shareMessage,url:r||""},a.janrain.social.addWidgetTo(t[0],n),a.janrain},initJanrain:function(){var o,i,l,c;i=t.get("janrainEngageAppName"),e.socialSettings.appName=i||e.socialSettings.appName,e.socialSettings.appUrl="https://"+e.socialSettings.appName+".rpxnow.com";try{e.socialSettings.providers=JSON.parse(atob(t.get("janrainShareProviders")))}catch(t){o=t,console.log("janrainShareProviders cookie error: "+o),e.socialSettings.providers=["native-facebook","native-googleplus","native-pinterest","native-reddit","native-tumblr","native-twitter"]}return null==(null!=(l=a.janrain)?l.settings:void 0)&&(a.janrain={settings:{}}),a.janrain.settings.appUrl=e.socialSettings.appUrl,a.janrain.settings.social={shareCountMode:"none",orientation:"horizontal",providers:e.socialSettings.providers},a.janrain.logShare=function(t,n){var s;return s="",s+="social_uid="+encodeURIComponent(t),s+="&social_site="+n,s+="&share_url="+encodeURIComponent(a.location.href),s+="&share_id="+encodeURIComponent(e.socialSettings.shareId),r.logSocialShare(s).then(function(e){return e})},null==(null!=(c=a.janrain)?c.social:void 0)?n.loadScript("//cdn-social.janrain.com/social/janrain-social.min.js").then(function(t){return s.getParticipantCenterWrapper().then(function(t){var r,n,s;return null!=(null!=t&&null!=(r=t.data)&&null!=(n=r.getParticipantCenterWrapperResponse)?n.wrapper:void 0)&&(s=t.data.getParticipantCenterWrapperResponse.wrapper,e.socialSettings.janrainEnabled=s.isJanrainEnabled,e.socialSettings.shareTitle=s.shareTitle,e.socialSettings.shareAction=s.shareAction,e.socialSettings.shareMessage=s.shareMessage,null!=s.shareId&&(e.socialSettings.shareId=s.shareId)),a.janrain.social.on("share_done",function(e){return window.janrain.logShare(e.auth_token,e.provider),e}),e.socialSettings.janrainInitialized=!0,t})}):s.getParticipantCenterWrapper().then(function(t){var r,n,s;return null!=(null!=t&&null!=(r=t.data)&&null!=(n=r.getParticipantCenterWrapperResponse)?n.wrapper:void 0)&&(s=t.data.getParticipantCenterWrapperResponse.wrapper,e.socialSettings.janrainEnabled=s.isJanrainEnabled,e.socialSettings.shareTitle=s.shareTitle,e.socialSettings.shareAction=s.shareAction,e.socialSettings.shareMessage=s.shareMessage,null!=s.shareId&&(e.socialSettings.shareId=s.shareId)),a.janrain.social.on("share_done",function(e){return window.janrain.logShare(e.auth_token,e.provider),e}),e.socialSettings.janrainInitialized=!0,t})}}}]),angular.module("trPcApp").factory("TeamraiserCompanyService",["LuminateRESTService",function(e){return{getCompanyList:function(){return e.teamraiserRequest("method=getCompanyList",!0,!0).then(function(e){return e})},getCompanies:function(t){var a;return a="method=getCompaniesByInfo",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!1,!0).then(function(e){return e})},getCompany:function(){var e,t;return this.getCompanies("company_id="+(null!=(e=$rootScope.participantRegistration)&&null!=(t=e.companyInformation)?t.companyId:void 0)).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserEmailService",["LuminateRESTService",function(e){return{addDraft:function(t){var a;return a="method=addDraft",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},updateDraft:function(t){var a;return a="method=updateDraft",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},deleteDraft:function(t){var a;return a="method=deleteDraft",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getDrafts:function(t){var a;return a="method=getDrafts",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getDraft:function(t){var a;return a="method=getDraft",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},deleteSentMessage:function(t){var a;return a="method=deleteSentMessage",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getSentMessages:function(t){var a;return a="method=getSentMessages",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getSentMessage:function(t){var a;return a="method=getSentMessage",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getMessageLayouts:function(){return e.teamraiserRequest("method=getMessageLayouts",!0,!0).then(function(e){return e})},getSuggestedMessages:function(){return e.teamraiserRequest("method=getSuggestedMessages",!0,!0).then(function(e){return e})},getSuggestedMessage:function(t){var a;return a="method=getSuggestedMessage",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},previewMessage:function(t){var a;return a="method=previewMessage",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},sendMessage:function(t){var a;return a="method=sendTafMessage",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserEventService",["$rootScope","LuminateRESTService",function(e,t){return{getConfig:function(){return t.teamraiserRequest("method=getTeamraiserConfig",!1,!0).then(function(t){var a;return a=t.data.getTeamraiserConfigResponse.teamraiserConfig,e.teamraiserConfig=a||-1,t})},getTeamraisers:function(e){var a;return a="method=getTeamraisersByInfo",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!1,!1).then(function(e){return e})},getTeamraiser:function(){return this.getTeamraisers("list_filter_column=frc.fr_id&list_filter_text="+e.frId+"&name="+encodeURIComponent("%")).then(function(t){var a,r,n;return(n=null!=(r=t.data.getTeamraisersResponse)?r.teamraiser:void 0)?((a=n.donate_event_url)&&-1!==a.indexOf("df_id=")&&(n.donationFormId=a.split("df_id=")[1].split("&")[0]),e.eventInfo=n):e.eventInfo=-1,t})},getEventDataParameter:function(e){var a;return a="method=getEventDataParameter",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!1,!0).then(function(e){return e})},getParticipationType:function(e){var a;return a="method=getParticipationType",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!1,!0).then(function(e){return e})},getParticipantCenterWrapper:function(){return t.teamraiserRequest("method=getParticipantCenterWrapper",!1,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserGiftService",["LuminateRESTService",function(e){return{getGiftCategories:function(){return e.teamraiserRequest("method=getGiftCategories",!0,!0).then(function(e){return e})},addGift:function(t){var a;return a="method=addGift",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},deleteGift:function(t){var a;return a="method=deleteGift",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},acknowledgeGift:function(t){var a;return a="method=acknowledgeGifts",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getGift:function(t){var a;return a="method=getGift",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getGifts:function(t){var a;return a="method=getGifts",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})},getTeamGifts:function(t){var a;return a="method=getTeamGifts",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserNewsFeedService",["LuminateRESTService",function(e){return{getNewsFeeds:function(t){var a;return a="method=getNewsFeeds",t&&""!==t&&(a+="&"+t),e.teamraiserRequest(a,!0,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserParticipantService",["$rootScope","LuminateRESTService",function(e,t){return{getParticipants:function(e){var a;return a="method=getParticipants",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!1,!0).then(function(e){return e})},getParticipant:function(){return this.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_filter_column=reg.cons_id&list_filter_text="+e.consId)}}}]),angular.module("trPcApp").factory("TeamraiserProgressService",["LuminateRESTService",function(e){return{getProgress:function(){return e.teamraiserRequest("method=getParticipantProgress",!1,!0).then(function(e){return e})},getWhatNext:function(){return e.teamraiserRequest("method=getTeamraiserSuggestion&show_all_suggestions=true",!1,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserRecentActivityService",["LuminateRESTService",function(e){return{getRecentActivity:function(){return e.teamraiserRequest("method=getRecentActivity",!0,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserRegistrationService",["$rootScope","LuminateRESTService",function(e,t){return{getRegistration:function(){return t.teamraiserRequest("method=getRegistration",!0,!0).then(function(t){var a,r;return a=null!=(r=t.data.getRegistrationResponse)?r.registration:void 0,e.participantRegistration=a||-1,t})},updateRegistration:function(e){var a;return a="method=updateRegistration",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},updatePersonalPagePrivacy:function(e){var a;return a="method=updatePersonalPagePrivacy",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserShortcutURLService",["$rootScope","LuminateRESTService",function(e,t){return{updateShortcut:function(e){var a;return a="method=updateShortcut",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getShortcut:function(){return t.teamraiserRequest("method=getShortcut",!0,!0).then(function(e){return e})},updateTeamShortcut:function(e){var a;return a="method=updateTeamShortcut",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getTeamShortcut:function(){return t.teamraiserRequest("method=getTeamShortcut",!0,!0).then(function(e){return e})},updateCompanyShortcut:function(a){var r;return r="method=updateCompanyShortcut&company_id="+e.participantRegistration.companyInformation.companyId,a&&""!==a&&(r+="&"+a),t.teamraiserRequest(r,!0,!0).then(function(e){return e})},getCompanyShortcut:function(){var a;return a="method=getCompanyShortcut&company_id="+e.participantRegistration.companyInformation.companyId,t.teamraiserRequest(a,!0,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserSurveyResponseService",["$rootScope","LuminateRESTService",function(e,t){return{getSurveyResponses:function(e){var a;return a="method=getSurveyResponses",a+="&use_filters=true",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},updateSurveyResponses:function(e){var a;return a="method=updateSurveyResponses",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})}}}]),angular.module("trPcApp").factory("TeamraiserTeamService",["$rootScope","LuminateRESTService",function(e,t){return{getTeams:function(e){var a;return a="method=getTeamsByInfo",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!1,!0).then(function(e){return e})},getTeam:function(){return this.getTeams("team_id="+e.participantRegistration.teamId)},getTeamRoster:function(a){var r;return r="method=getTeamRoster&team_id="+e.participantRegistration.teamId,a&&""!==a&&(r+="&"+a),t.teamraiserRequest(r,!0,!0).then(function(e){return e})},joinTeam:function(e){var a;return a="method=joinTeam",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},leaveTeam:function(){return t.teamraiserRequest("method=leaveTeam",!0,!0).then(function(e){return e})},updateTeamInformation:function(e){var a;return a="method=updateTeamInformation",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},setTeamCaptains:function(a){var r;return r="method=setTeamCaptains&team_id="+e.participantRegistration.teamId,a&&""!==a&&(r+="&"+a),t.teamraiserRequest(r,!0,!0).then(function(e){return e})},getTeamCaptains:function(){return t.teamraiserRequest("method=getTeamCaptains",!1,!0).then(function(e){return e})},updateCaptainsMessage:function(e){var a;return a="method=updateCaptainsMessage",e&&""!==e&&(a+="&"+e),t.teamraiserRequest(a,!0,!0).then(function(e){return e})},getCaptainsMessage:function(){return t.teamraiserRequest("method=getCaptainsMessage",!0,!0).then(function(e){return e})}}}]),angular.module("trPcControllers").controller("ConsProfileViewCtrl",["$scope","$httpParamSerializer","$translate","$timeout","$uibModal","ConstituentService","APP_INFO",function(e,t,a,r,n,s,o){var i,l,c;return e.consProfilePromises=[],c=["user_name","name.title","name.first","name.middle","name.last","name.suffix","name.prof_suffix","email.primary_address","email.accepts_email","primary_address.street1","primary_address.street2","primary_address.street3","primary_address.city","primary_address.state","primary_address.zip","primary_address.country","accepts_postal_mail","home_phone","birth_date","gender","employment.employer","employment.occupation"],e.cpvm={profileFields:[],passwordFields:[{type:"input",key:"old_password",templateOptions:{type:"password",label:"Old Password",required:!0}},{type:"input",key:"user_password",templateOptions:{type:"password",label:"New Password",required:!0}},{type:"input",key:"retype_password",templateOptions:{type:"password",label:"Retype Password",required:!0}},{type:"input",key:"reminder_hint",templateOptions:{type:"text",label:"Reminder Hint",required:!0}}],profileModel:{},passwordModel:{old_password:"",user_password:"",retype_password:"",reminder_hint:""},openChangePassword:e.openChangePassword,cancelChangePassword:e.cancelChangePassword,submitChangePassword:e.submitChangePassword,updateUserProfile:e.updateUserProfile},(i=function(){return e.getFieldLabelTranslationsTimeout&&r.cancel(e.getFieldLabelTranslationsTimeout),a(["old_password","new_password","new_password_repeat","password_hint"]).then(function(t){return angular.forEach(e.cpvm.passwordFields,function(e){switch(e.key){case"old_password":return e.templateOptions.label=t.old_password;case"user_password":return e.templateOptions.label=t.new_password;case"retype_password":return e.templateOptions.label=t.new_password_repeat;case"reminder_hint":return e.templateOptions.label=t.password_hint}})},function(t){return e.getFieldLabelTranslationsTimeout=r(i,500)})})(),e.openChangePassword=function(){return e.changePasswordModal=n.open({scope:e,appendTo:angular.element(document).find("div.ng-pc-container"),templateUrl:o.rootPath+"html/modal/changePassword.html"})},e.cancelChangePassword=function(t){return t.preventDefault(),e.changePasswordModal.close()},e.getUser=function(){var t;return t=s.getUser().then(function(t){return e.constituent=t.data.getConsResponse,angular.forEach(e.cpvm.profileFields,function(t){var a,r,n,s,o,i,l;if(r=t.name,n=null,r.indexOf("custom_")>-1)a=r.slice(7).replace(/\d+/g,""),e.constituent.custom&&e.constituent.custom[a]&&angular.forEach(e.constituent.custom[a],function(e){if(r===e.id)return n=e.content});else if(r.indexOf(".")>-1){for(r=r.split("."),l=e.constituent,s=o=0,i=r.length-1;0<=i?o<=i:o>=i;s=0<=i?++o:--o)l[r[s]]&&(l=l[r[s]]);l&&!angular.isObject(l)&&(n=l)}else e.constituent[r]&&!angular.isObject(e.constituent[r])&&(n=e.constituent[r]);if(n)switch(t.data.dataType){case"DATE":n=n.split("-"),n=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]),parseInt(n[3].split(":")[0]),parseInt(n[3].split(":")[1]));break;case"BOOLEAN":n="true"===n;break;default:n=n}else n=null;return e.cpvm.profileModel[t.key]=n}),e.constituent.reminder_hint&&(e.cpvm.passwordModel.reminder_hint=e.constituent.reminder_hint),e.cpvm.profileOptions.updateInitialValue(),t}),e.consProfilePromises.push(t)},l=s.listUserFields("access=update").then(function(t){return e.userFields=t.data.listConsFieldsResponse.field,angular.isArray(e.userFields)||(e.userFields=[e.userFields]),angular.forEach(e.userFields,function(t){var a,r,n,s,o,i,l,u,p,m,d,g;if(c.indexOf(t.name)>-1){switch(g={type:null,key:t.name.replace(".","-"),name:t.name,data:{dataType:t.valueType,orderInd:c.indexOf(t.name)},templateOptions:{label:t.label,required:"true"===t.required,maxChars:t.maxChars}},t.valueType){case"BOOLEAN":g.type="checkbox";break;case"DATE":if(g.type="datepicker",g.templateOptions.placeholder="MM/dd/yyyy",g.templateOptions.closeText="Close",g.templateOptions.dateOptions={dateFormat:"MM/dd/yyyy"},null!=(u=t.choices)?u.choice:void 0){for(l=i=t.choices.choice[0],r=0,s=(p=t.choices.choice).length;r<s;r++)l=l<(a=p[r])?l:a;for(n=0,o=(m=t.choices.choice).length;n<o;n++)i=i>(a=m[n])?i:a;g.templateOptions.dateOptions.minDate=new Date(l,0,1),g.templateOptions.dateOptions.maxDate=new Date(i,11,31)}g.templateOptions.dateAltFormats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"];break;case"ENUMERATION":g.type="select",g.templateOptions.options=[],angular.forEach(t.choices.choice,function(e){return g.templateOptions.options.push({name:"UNDEFINED"===e?"":e,value:e})});break;case"TEXT":(null!=(d=t.choices)?d.choice:void 0)?(g.type="select",g.templateOptions.options=[],angular.forEach(t.choices.choice,function(e){return g.templateOptions.options.push({name:e,value:e})})):g.type="input";break;default:g.type="input"}return"user_name"===t.name&&(g.type="username",g.templateOptions.changePasswordLabel="Change Password",g.templateOptions.changePasswordAction=e.openChangePassword),e.cpvm.profileFields.push(g)}}),e.cpvm.profileFields.sort(function(e,t){return e.data.orderInd-t.data.orderInd}),a(["accept_email_label","accept_postal_mail_label","change_password_label"]).then(function(t){return angular.forEach(e.cpvm.profileFields,function(e){switch(e.name){case"accepts_postal_mail":return e.templateOptions.label=t.accept_postal_mail_label;case"email.accepts_email":return e.templateOptions.label=t.accept_email_label;case"user_name":return e.templateOptions.changePasswordLabel=t.change_password_label}}),e.cpvm.originalFields=angular.copy(e.cpvm.profileFields)},function(t){return angular.forEach(e.cpvm.profileFields,function(e){switch(e.name){case"accepts_postal_mail":return e.templateOptions.label=t.accept_postal_mail_label;case"email.accepts_email":return e.templateOptions.label=t.accept_email_label;case"user_name":return e.templateOptions.changePasswordLabel=t.change_password_label}}),e.cpvm.originalFields=angular.copy(e.cpvm.profileFields)}),e.getUser(),t}),e.consProfilePromises.push(l),e.updateUserProfile=function(){var r,n;return e.cpvm.profileForm.$valid?(n={},angular.forEach(e.cpvm.profileModel,function(e,t){var a;return a=t.replace("-","."),n[a]=e}),r=s.update(t(n)).then(function(t){return t.data.errorResponse?(e.updateProfileSuccess=!1,e.updateProfileFailure=!0,t.data.errorResponse.message?e.updateProfileFailureMessage=t.data.errorResponse.message:a("profile_update_unexpected_error").then(function(t){return e.updateProfileFailureMessage=t},function(t){return e.updateProfileFailureMessage=t})):(e.updateProfileSuccess=!0,e.updateProfileFailure=!1,e.cpvm.profileOptions.updateInitialValue()),t}),e.consProfilePromises.push(r)):(a("profile_update_required_error").then(function(t){return e.updateProfileFailureMessage=t},function(t){return e.updateProfileFailureMessage=t}),e.updateProfileSuccess=!1,e.updateProfileFailure=!0)},e.submitChangePassword=function(){var r;return r=s.changePassword(t(e.cpvm.passwordModel)).then(function(t){var r;return t.data.errorResponse?(e.updatePasswordSuccess=!1,e.updatePasswordFailure=!0,t.data.errorResponse.message?e.updatePasswordFailureMessage=t.data.errorResponse.message:a("profile_update_unexpected_error").then(function(t){return e.updatePasswordFailureMessage=t},function(t){return e.updatePasswordFailureMessage=t}),e.cpvm.passwordOptions.resetModel()):(e.updatePasswordSuccess=!0,e.updatePasswordFailure=!1,e.changePasswordModal.close(),r=e.cpvm.passwordModel.reminder_hint,e.cpvm.passwordOptions.resetModel(),e.cpvm.passwordModel.reminder_hint=r,e.cpvm.passwordOptions.updateInitialValue()),t}),e.consProfilePromises.push(r)},e.resetProfileAlerts=function(){return e.updateProfileSuccess=!1,e.updateProfileFailure=!1,e.updateProfileFailureMessage="",e.updatePasswordSuccess=!1,e.updatePasswordFailure=!1,e.updatePasswordFailureMessage="",!0},e.resetProfileAlerts()}]),angular.module("trPcControllers").controller("DashboardViewCtrl",["$scope","$rootScope","$location","$uibModal","$timeout","$translate","$window","ConstituentService","TeamraiserNewsFeedService","TeamraiserRegistrationService","TeamraiserRecentActivityService","ContactService","TeamraiserProgressService","TeamraiserEventService","TeamraiserGiftService","TeamraiserParticipantService","TeamraiserTeamService","TeamraiserShortcutURLService","APP_INFO",function(e,t,a,r,n,s,o,i,l,c,u,p,m,d,g,_,f,h,y){var v,b,C,T,P,S,w,R,A,M,k,I,E,G,O,N,F;if(e.dashboardPromises=[],T=i.getUser().then(function(t){return e.constituent=t.data.getConsResponse,t}),e.dashboardPromises.push(T),M=_.getParticipant().then(function(t){var a,r,n,s,o,i;return null!=(r=(null!=(o=t.data.getParticipantsResponse)?o.participant:void 0)||{}).personalPageUrl&&(r.personalPageAbsoluteUrl=r.personalPageUrl,-1!==r.personalPageUrl.indexOf("/site/")&&(r.personalPageUrl=r.personalPageUrl.split("/site/")[1])),null!=r.donationUrl&&(r.donationAbsoluteUrl=r.donationUrl,-1!==r.donationUrl.indexOf("/site/")&&(r.donationUrl=r.donationUrl.split("/site/")[1])),null!=r.teamPageUrl&&(r.teamPageAbsoluteUrl=r.teamPageUrl,-1!==r.teamPageUrl.indexOf("/site/")&&(r.teamPageUrl=r.teamPageUrl.split("/site/")[1])),e.participant=r,(a=null!=(i=e.participant)?i.badges:void 0)?((s=a.personalDonationBadgeLargeUrl)&&(e.participantBadges||(e.participantBadges=[]),e.participantBadges.push({url:".."+s,name:a.personalDonationBadgeName,description:a.personalDonationBadgeDesc})),(n=a.participantMilestoneLargeBadgeUrl)&&(e.participantBadges||(e.participantBadges=[]),e.participantBadges.push({url:".."+n,name:a.participantMilestoneBadgeName,description:a.participantMilestoneBadgeDesc}))):e.participantBadges=[],t}),e.dashboardPromises.push(M),I=function(){return e.teamraiserConfig=t.teamraiserConfig,e.teamraiserConfig.personalDonationsDownloadUrl||(e.teamraiserConfig.personalDonationsDownloadUrl="TRParticipantDownload/Personal_Donations.csv?download_type=personal_donations&fr_id="+t.frId),e.teamraiserConfig},t.teamraiserConfig&&-1!==t.teamraiserConfig?I():(w=d.getConfig().then(function(e){return I(),e}),e.dashboardPromises.push(w)),e.showJanrainShare=(null!=(k=t.socialSettings.appName)?k.length:void 0)>0,"true"===e.teamraiserConfig.adminNewsFeedsEnabled&&(e.newsFeed={page:1,numPerPage:1},e.getNewsFeeds=function(){var t,a;return a=e.newsFeed.page-1,t=l.getNewsFeeds("last_pc2_login="+e.participantRegistration.lastPC2Login+"&feed_count=100").then(function(t){var r;return r=t.data.getNewsFeedsResponse.newsFeed,angular.isArray(r)||(r=[r]),e.newsFeed.items=[],e.newsFeed.totalNumber=0,angular.forEach(r,function(t,r){var n;if(("true"===(null!=(n=e.participant)?n.aTeamCaptain:void 0)||"false"===t.isCaptainsOnly)&&(e.newsFeed.totalNumber+=1,r>a-1&&e.newsFeed.items.length<e.newsFeed.numPerPage))return e.newsFeed.items.push(t)}),t}),e.dashboardPromises.push(t)},e.getNewsFeeds()),c.updateRegistration("update_last_pc2_login=true"),e.recentActivity={page:1},e.getRecentActivity=function(){var t,a;return t=e.recentActivity.page-1,a=u.getRecentActivity().then(function(a){var r;return r=a.data.getRecentActivityResponse.activityRecord,angular.isArray(r)||(r=[r]),e.recentActivity.records=[],angular.forEach(r,function(a,r){if(r>5*t-1&&r<5*(t+1))return e.recentActivity.records.push(a)}),e.recentActivity.totalNumber=r.length,a}),e.dashboardPromises.push(a)},e.getRecentActivity(),e.whatNextAction=function(t){switch(t){case"PERSONAL_PAGE":o.open(e.participant.personalPageUrl,"_blank");break;case"GOAL":e.editGoal("Participant");break;case"CONTACTS":a.path("/email/contacts");break;case"COMPOSE":a.path("/email/compose");break;case"COMPOSE_THANKS":a.path("/email/compose/group/email_rpt_show_unthanked_donors");break;case"COMPOSE_OTHER":a.path("/email/compose/group/email_rpt_show_never_emailed");break;case"COMPOSE_FOLLOWUP":a.path("/email/compose/group/email_rpt_show_nondonors_followup")}return t},e.whatNext={suggestions:[]},F=m.getWhatNext().then(function(t){var a;return a=t.data.getTeamraiserSuggestionResponse.allSuggestions.suggestion,angular.isArray(a)||(a=[a]),e.whatNext.suggestions=[],angular.forEach(a,function(t,a){return t.displayNumber=a+1,t.header="",t.nextAction=function(){return e.whatNextAction(t.type)},e.whatNext.suggestions.push(t)}),s(["what_next_setup_your_personal_page_header","what_next_set_goal_header","what_next_send_email_header","what_next_reach_out_header","what_next_send_thanks_header","what_next_add_contacts_header","what_next_followup_header"]).then(function(t){return angular.forEach(e.whatNext.suggestions,function(e){switch(e.type){case"PERSONAL_PAGE":return e.header=t.what_next_setup_your_personal_page_header;case"GOAL":return e.header=t.what_next_set_goal_header;case"CONTACTS":return e.header=t.what_next_add_contacts_header;case"COMPOSE":return e.header=t.what_next_send_email_header;case"COMPOSE_THANKS":return e.header=t.what_next_send_thanks_header;case"COMPOSE_OTHER":return e.header=t.what_next_reach_out_header;case"COMPOSE_FOLLOWUP":return e.header=t.what_next_followup_header}})},function(t){return angular.forEach(e.whatNext.suggestions,function(e){switch(e.type){case"PERSONAL_PAGE":return e.header=t.what_next_setup_your_personal_page_header;case"GOAL":return e.header=t.what_next_set_goal_header;case"CONTACTS":return e.header=t.what_next_add_contacts_header;case"COMPOSE":return e.header=t.what_next_send_email_header;case"COMPOSE_THANKS":return e.header=t.what_next_send_thanks_header;case"COMPOSE_OTHER":return e.header=t.what_next_reach_out_header;case"COMPOSE_FOLLOWUP":return e.header=t.what_next_followup_header}})})}),e.dashboardPromises.push(F),e.contactCounts={},P=["email_rpt_show_all","email_rpt_show_never_emailed","email_rpt_show_nondonors_followup","email_rpt_show_unthanked_donors","email_rpt_show_donors","email_rpt_show_nondonors"],angular.forEach(P,function(t){var a;return a=p.getTeamraiserAddressBookContacts("tr_ab_filter="+t+"&skip_groups=true&list_page_size=1").then(function(a){return e.contactCounts[t]=a.data.getTeamraiserAddressBookContactsResponse.totalNumberResults,a}),e.dashboardPromises.push(a)}),e.participantProgress={raised:0,goal:0,percent:0},e.participantRegistration.teamId&&"-1"!==e.participantRegistration.teamId&&(e.teamProgress={raised:0,goal:0,percent:0}),e.participantRegistration.companyInformation&&e.participantRegistration.companyInformation.companyId&&(e.companyProgress={raised:0,goal:0,percent:0}),e.refreshFundraisingProgress=function(){var t;return t=m.getProgress().then(function(t){return e.participantProgress=t.data.getParticipantProgressResponse.personalProgress,e.participantRegistration.teamId&&"-1"!==e.participantRegistration.teamId&&(e.teamProgress=t.data.getParticipantProgressResponse.teamProgress),e.participantRegistration.companyInformation&&e.participantRegistration.companyInformation.companyId&&(e.companyProgress=t.data.getParticipantProgressResponse.companyProgress),t}),e.dashboardPromises.push(t)},e.refreshFundraisingProgress(),e.editGoalOptions={updateGoalSuccess:!1,updateGoalFailure:!1,updateGoalFailureMessage:"",updateGoalInput:0},e.closeGoalAlerts=function(t){if(e.editGoalOptions.updateGoalSuccess=!1,e.editGoalOptions.updateGoalFailure=!1,e.editGoalOptions.updateGoalFailureMessage="",t)return e.cancelEditGoal()},e.editGoal=function(t){switch(e.closeGoalAlerts(!1),t){case"Participant":e.editGoalOptions.updateGoalInput=Math.floor(parseInt(e.participantProgress.goal)/100);break;case"Team":e.editGoalOptions.updateGoalInput=Math.floor(parseInt(e.teamProgress.goal)/100);break;default:e.editGoalOptions.updateGoalInput=0}return e.editGoalModal=r.open({scope:e,templateUrl:y.rootPath+"html/modal/edit"+t+"Goal.html"})},e.cancelEditGoal=function(){return e.editGoalModal.close()},e.updateGoal=function(t){var a,r;switch(e.closeGoalAlerts(!1),t){case"Participant":return a="goal="+(100*e.editGoalOptions.updateGoalInput).toString(),r=c.updateRegistration(a).then(function(t){return t.data.errorResponse?(e.editGoalOptions.updateGoalFailure=!0,t.data.errorResponse.message?e.editGoalOptions.updateGoalFailureMessage=t.data.errorResponse.message:s("personal_goal_unexpected_error").then(function(t){return e.editGoalOptions.updateGoalFailureMessage=t},function(t){return e.editGoalOptions.updateGoalFailureMessage=t})):(e.editGoalOptions.updateGoalSuccess=!0,e.refreshFundraisingProgress()),t}),e.dashboardPromises.push(r);case"Team":return a="team_goal="+(100*e.editGoalOptions.updateGoalInput).toString(),r=f.updateTeamInformation(a).then(function(t){return t.data.errorResponse?(e.editGoalOptions.updateGoalFailure=!0,t.data.errorResponse.message?e.editGoalOptions.updateGoalFailureMessage=t.data.errorResponse.message:s("team_goal_unexpected_error").then(function(t){return e.editGoalOptions.updateGoalFailureMessage=t},function(t){return e.editGoalOptions.updateGoalFailureMessage=t})):(e.editGoalOptions.updateGoalSuccess=!0,e.refreshFundraisingProgress()),t}),e.dashboardPromises.push(r)}},(N=function(){return e.translateGiftActionLabelsTimeout&&n.cancel(e.translateGiftActionLabelsTimeout),e.giftActionLabels={acknowledgeGift:"",thankDonor:"",deleteGift:"",noAction:""},s(["gift_action_acknowledge_title","gift_action_thank_donor_title","gift_action_delete_title","gift_action_no_action_title"]).then(function(t){return e.giftActionLabels.acknowledgeGift=t.gift_action_acknowledge_title,e.giftActionLabels.thankDonor=t.gift_action_thank_donor_title,e.giftActionLabels.deleteGift=t.gift_action_delete_title,e.giftActionLabels.noAction=t.gift_action_no_action_title},function(t){return e.translateGiftActionLabelsTimeout=n(N,500)})})(),e.participantGifts={page:1},e.getGifts=function(){var t,a;return t=e.participantGifts.page-1,a=g.getGifts("list_sort_column=date_recorded&list_ascending=false&list_page_size=5&list_page_offset="+t).then(function(t){var a;return a=t.data.getGiftsResponse.gift,angular.isArray(a)||(a=[a]),e.participantGifts.gifts=[],angular.forEach(a,function(t){if(t)return t.contact={firstName:t.name.first,lastName:t.name.last,email:t.email,id:t.contactId},e.participantGifts.gifts.push(t)}),e.participantGifts.giftActionLabels=e.giftActionLabels,e.participantGifts.totalNumber=Number(t.data.getGiftsResponse.totalNumberResults),t}),e.dashboardPromises.push(a)},e.getGifts(),e.acknowledgeGift=function(t){return e.acknowledgeGiftContactId=t,e.acknowledgeGiftModal=r.open({scope:e,templateUrl:y.rootPath+"html/modal/acknowledgeGift.html"})},b=function(){return delete e.acknowledgeGiftContactId,e.acknowledgeGiftModal.close()},e.cancelAcknowledgeGift=function(){return b()},e.confirmAcknowledgeGift=function(){var t;if(e.acknowledgeGiftContactId)return t=g.acknowledgeGift("contact_id="+e.acknowledgeGiftContactId).then(function(t){return b(),e.getGifts(),e.participantRegistration.teamId&&"-1"!==e.participantRegistration.teamId&&(e.teamGifts.page=1,e.getTeamGifts()),t}),e.dashboardPromises.push(t)},e.deleteGift=function(t){return e.deleteGiftId=t,e.deleteGiftModal=r.open({scope:e,templateUrl:y.rootPath+"html/modal/deleteGift.html"})},C=function(){return delete e.deleteGiftId,e.deleteGiftModal.close()},e.cancelDeleteGift=function(){return C()},e.confirmDeleteGift=function(){var t;if(e.deleteGiftId)return t=g.deleteGift("gift_id="+e.deleteGiftId).then(function(t){return C(),e.getGifts(),e.participantRegistration.teamId&&"-1"!==e.participantRegistration.teamId&&e.getTeamGifts(),t}),e.dashboardPromises.push(t)},e.thankDonor=function(e){if(null!=e)return t.selectedContacts||(t.selectedContacts={}),t.selectedContacts.contacts=[e],a.path("/email/compose")},"PARTICIPANTS"===e.teamraiserConfig.personalPageEditing||e.participantRegistration.teamId<=0?e.showPersonalPage=!0:"CAPTAINS"===e.teamraiserConfig.personalPageEditing&&"true"===e.participantRegistration.aTeamCaptain?e.showPersonalPage=!0:e.showPersonalPage=!1,R=h.getShortcut().then(function(t){var a;return e.participantShortcut=null!=(a=t.data.getShortcutResponse)?a.shortcutItem:void 0,t}),e.dashboardPromises.push(R),e.editPageUrlOptions={updateUrlSuccess:!1,updateUrlFailure:!1,updateUrlFailureMessage:"",updateUrlInput:""},e.closeUrlAlerts=function(t){if(e.editPageUrlOptions.updateUrlSuccess=!1,e.editPageUrlOptions.updateUrlFailure=!1,e.editPageUrlOptions.updateUrlFailureMessage="",t)return e.cancelEditPageUrl()},e.editPageUrl=function(t){switch(e.closeUrlAlerts(!1),t){case"Participant":e.editPageUrlOptions.updateUrlInput=e.participantShortcut.text||"";break;case"Team":e.editPageUrlOptions.updateUrlInput=e.teamShortcut.text||"";break;case"Company":e.editPageUrlOptions.updateUrlInput=e.companyShortcut.text||"";break;default:e.editPageUrlOptions.updateUrlInput=""}return e.editPageUrlModal=r.open({scope:e,templateUrl:y.rootPath+"html/modal/edit"+t+"PageUrl.html"})},e.cancelEditPageUrl=function(){return e.editPageUrlModal.close()},e.updatePageUrl=function(t){var a,r;if(e.closeUrlAlerts(!1),e.editPageUrlOptions.updateUrlInput.length<5)return e.editPageUrlOptions.updateUrlFailure=!0,s("shortcut_error_min_length").then(function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t},function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t});switch(a="text="+e.editPageUrlOptions.updateUrlInput,t){case"Participant":return r=h.updateShortcut(a).then(function(t){var a,r;return t.data.errorResponse?(e.editPageUrlOptions.updateUrlFailure=!0,(null!=(a=t.data.errorResponse)?a.message:void 0)?e.editPageUrlOptions.updateUrlFailureMessage=t.data.errorResponse.message:s("shortcut_save_failure").then(function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t},function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t})):(e.editPageUrlOptions.updateUrlSuccess=!0,e.participantShortcut=null!=(r=t.data.updateShortcutResponse)?r.shortcutItem:void 0),t}),e.dashboardPromises.push(r);case"Team":return r=h.updateTeamShortcut(a).then(function(t){var a,r;return t.data.errorResponse?(e.editPageUrlOptions.updateUrlFailure=!0,(null!=(a=t.data.errorResponse)?a.message:void 0)?e.editPageUrlOptions.updateUrlFailureMessage=t.data.errorResponse.message:s("teampage_shortcut_save_failure").then(function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t},function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t})):(e.editPageUrlOptions.updateUrlSuccess=!0,e.teamShortcut=null!=(r=t.data.updateTeamShortcutResponse)?r.shortcutItem:void 0),t}),e.dashboardPromises.push(r);case"Company":return r=h.updateCompanyShortcut(a).then(function(t){var a,r;return t.data.errorResponse?(e.editPageUrlOptions.updateUrlFailure=!0,(null!=(a=t.data.errorResponse)?a.message:void 0)?e.editPageUrlOptions.updateUrlFailureMessage=t.data.errorResponse.message:s("company_page_shortcut_save_failure").then(function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t},function(t){return e.editPageUrlOptions.updateUrlFailureMessage=t})):(e.editPageUrlOptions.updateUrlSuccess=!0,e.companyShortcut=null!=(r=t.data.updateCompanyShortcutResponse)?r.shortcutItem:void 0),t}),e.dashboardPromises.push(r)}},e.participantRegistration.teamId&&"-1"!==e.participantRegistration.teamId&&(v=f.getCaptainsMessage().then(function(t){return e.teamCaptainsMessage=t.data.getCaptainsMessageResponse,angular.isString(e.teamCaptainsMessage.message)||delete e.teamCaptainsMessage.message,e.teamCaptainsMessage.inEditMode=!1,t}),e.dashboardPromises.push(v),e.editTeamCaptainsMessage=function(){return e.teamCaptainsMessage.inEditMode=!0},e.saveTeamCaptainsMessage=function(){var t;return t=f.updateCaptainsMessage("captains_message="+encodeURIComponent(e.teamCaptainsMessage.message)).then(function(t){return e.teamCaptainsMessage.inEditMode=!1,t}),e.dashboardPromises.push(t)},O=f.getTeamRoster("include_download_url=true&positive_amount_only=true").then(function(a){return a.data.getTeamRosterResponse&&(e.teamRosterDownloadUrl=a.data.getTeamRosterResponse.teamRosterDownloadUrl||"TRParticipantDownload/Team_Roster.csv?download_type=team_roster&fr_id="+t.frId,e.teamDonationsDownloadUrl=a.data.getTeamRosterResponse.teamDonationsDownloadUrl||"TRParticipantDownload/Team_Donations.csv?download_type=team_donations&fr_id="+t.frId),a}),e.dashboardPromises.push(O),G=f.getTeam().then(function(t){var a,r,n,s;return n=null!=(r=t.data.getTeamSearchByInfoResponse)?r.team:void 0,(a=null!=n?n.badges:void 0)?(s=a.teamMilestoneBadgeLargeUrl)&&(e.teamBadges||(e.teamBadges=[]),e.teamBadges.push({url:".."+s,name:a.teamMilestoneBadgeName,description:a.teamMilestoneBadgeDesc})):e.teamBadges=[],t}),e.dashboardPromises.push(G),e.teamGifts={page:1},e.getTeamGifts=function(){var t,a;return t=e.teamGifts.page-1,a=g.getTeamGifts("list_sort_column=date_recorded&list_ascending=false&list_page_size=5&list_page_offset="+t).then(function(t){var a;return a=t.data.getGiftsResponse.gift,angular.isArray(a)||(a=[a]),e.teamGifts.gifts=[],angular.forEach(a,function(t){if(t)return t.contact={firstName:t.name.first,lastName:t.name.last,email:t.email,id:t.contactId},e.teamGifts.gifts.push(t)}),e.teamGifts.giftActionLabels=e.giftActionLabels,e.teamGifts.totalNumber=Number(t.data.getGiftsResponse.totalNumberResults),t}),e.dashboardPromises.push(a)},e.getTeamGifts(),e.editTeamName={newTeamName:"",editTeamNameSuccess:!1,editTeamNameFailure:!1,editTeamNameFailureMessage:""},e.changeTeamName=function(){return e.editTeamName.newTeamName=e.participant.teamName,e.editTeamNameModal=r.open({scope:e,templateUrl:y.rootPath+"html/modal/editTeamName.html"})},e.updateTeamName=function(){var t,a;return e.cancelEditTeamName(!1),t="team_name="+e.editTeamName.newTeamName,a=f.updateTeamInformation(t).then(function(t){var a;return t.data.errorResponse?(e.editTeamName.editTeamNameFailure=!0,t.data.errorResponse.message?e.editTeamName.editTeamNameFailureMessage=null!=(a=t.data.errorResponse)?a.message:void 0:s("team_name_update_unexpected_error").then(function(t){return e.editTeamName.editTeamNameFailureMessage=t},function(t){return e.editTeamName.editTeamNameFailureMessage=t})):e.editTeamName.editTeamNameSuccess=!0,t}),e.dashboardPromises.push(a)},e.cancelEditTeamName=function(t){if(e.editTeamName.editTeamNameSuccess=!1,e.editTeamName.editTeamNameFailure=!1,e.editTeamName.editTeamNameFailureMessage="",t)return e.editTeamName.newTeamName="",e.editTeamNameModal.close()},e.changeTeamCaptains=function(){var a;return e.editTeamCaptains={success:!1,failure:!1,failureMessage:"",maxCaptains:e.teamraiserConfig.teamCaptainsMaximum,currCaptains:0,teamRoster:[],teamSize:1,teamRosterPage:1,teamPageSize:5},a=_.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_filter_column=reg.team_id&list_filter_text="+e.participantRegistration.teamId+"&list_page_size=400&list_page_offset=0").then(function(a){var r,n;return n=null!=(r=a.data.getParticipantsResponse)?r.participant:void 0,angular.isArray(n)||(n=[n]),e.editTeamCaptains.teamSize=a.data.getParticipantsResponse.totalNumberResults,angular.forEach(n,function(t){if((null!=t?t.consId:void 0)&&(t.consId=parseInt(t.consId),t.aTeamCaptain="true"===t.aTeamCaptain,t.aTeamCaptain))return e.editTeamCaptains.teamSize=e.editTeamCaptains.teamSize-1}),e.editTeamCaptains.teamRoster=n.sort(function(e,a){var r,n,s,o;return e.consId===t.consId?-1:a.consId===t.consId?1:(r=(null!=(s=e.name)?s.screenname:void 0)?e.name.screenname.toLowerCase():e.name.last.toLowerCase()+", "+e.name.first.toLowerCase(),n=(null!=(o=a.name)?o.screenname:void 0)?a.name.screenname.toLowerCase():a.name.last.toLowerCase()+", "+a.name.first.toLowerCase(),r<n?-1:r>n?1:0)}),E(),a}),e.dashboardPromises.push(a),e.editTeamCaptainsModal=r.open({scope:e,templateUrl:y.rootPath+"html/modal/editTeamCaptains.html"})},E=function(){var a,r,n;return r=1,a=0,n=e.editTeamCaptains.teamPageSize,angular.forEach(e.editTeamCaptains.teamRoster,function(e){if((null!=e?e.consId:void 0)&&(e.displayPage=e.consId===t.consId?0:r,!e.aTeamCaptain&&(a+=1)>=n))return r+=1,a=0}),e.editTeamCaptains.teamRoster},e.toggleTeamCaptain=function(t){var a;return a=!1,angular.forEach(e.editTeamCaptains.teamRoster,function(r){if(t===r.consId)return a=!0,r.aTeamCaptain=!r.aTeamCaptain,e.editTeamCaptains.teamSize=e.editTeamCaptains.teamSize+(r.aTeamCaptain?-1:1)}),a&&E(),a},e.confirmChangeTeamCaptains=function(){var t,a,r;return e.resetTeamCaptainAlerts(!1),a=[],angular.forEach(e.editTeamCaptains.teamRoster,function(e){if((null!=e?e.consId:void 0)&&(null!=e?e.aTeamCaptain:void 0))return a.push(e.consId)}),0===a.length?(e.editTeamCaptains.failure=!0,s("team_captains_failure_minimum").then(function(t){return e.editTeamCaptains.failureMessage=t},function(t){return e.editTeamCaptains.failureMessage=t})):a.length>e.teamraiserConfig.teamCaptainsMaximum?(e.editTeamCaptains.failure=!0,s("team_captains_failure_maximum",{max:e.editTeamCaptains.maxCaptains}).then(function(t){return e.editTeamCaptains.failureMessage=t},function(t){return e.editTeamCaptains.failureMessage=t})):(t="captains="+a.toString(),r=f.setTeamCaptains(t).then(function(t){return t.data.errorResponse?(e.editTeamCaptains.failure=!0,t.data.errorResponse.message?e.editTeamCaptains.failureMessage=t.data.errorResponse.message:s("captains_save_failure").then(function(t){return e.editTeamCaptains.failureMessage=t},function(t){return e.editTeamCaptains.failureMessage=t})):(e.editTeamCaptains.success=!0,e.getTeamMembers()),t}),e.dashboardPromises.push(r))},e.resetTeamCaptainAlerts=function(t){if(e.editTeamCaptains.success=!1,e.editTeamCaptains.failure=!1,e.editTeamCaptains.failureMessage="",t)return e.editTeamCaptainsModal.close()},e.editTeamPassword={newTeamPassword:"",editTeamPasswordSuccess:!1,editTeamPasswordFailure:!1,editTeamPasswordFailureMessage:""},e.setTeamPassword=function(){var t;return e.editTeamPassword.newTeamPassword=(null!=(t=e.participantRegistration.teamInformation)?t.password:void 0)||"",e.editTeamPasswordModal=r.open({scope:e,templateUrl:y.rootPath+"html/modal/editTeamPassword.html"})},e.updateTeamPassword=function(){var t,a;return e.cancelEditTeamPassword(!1),t="password="+e.editTeamPassword.newTeamPassword,a=f.updateTeamInformation(t).then(function(t){return t.data.errorResponse?(e.editTeamPassword.editTeamPasswordFailure=!0,t.data.errorResponse.message?e.editTeamPassword.editTeamPasswordFailureMessage=t.data.errorResponse.message:s("team_password_update_unexpected_error").then(function(t){return e.editTeamPassword.editTeamPasswordFailureMessage=t},function(t){return e.editTeamPassword.editTeamPasswordFailureMessage=t})):e.editTeamPassword.editTeamPasswordSuccess=!0,t}),e.dashboardPromises.push(a)},e.cancelEditTeamPassword=function(t){if(e.editTeamPassword.editTeamPasswordSuccess=!1,e.editTeamPassword.editTeamPasswordFailure=!1,e.editTeamPassword.editTeamPasswordFailureMessage="",t)return e.editTeamPassword.newTeamPassword="",e.editTeamPasswordModal.close()},e.teamMembers={page:1},e.getTeamMembers=function(){var t,a;return t=e.teamMembers.page-1,a=_.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_filter_column=reg.team_id&list_filter_text="+e.participantRegistration.teamId+"&list_page_size=5&list_page_offset="+t).then(function(t){var a;return a=t.data.getParticipantsResponse.participant,angular.isArray(a)||(a=[a]),e.teamMembers.members=a,e.teamMembers.totalNumber=t.data.getParticipantsResponse.totalNumberResults,t}),e.dashboardPromises.push(a)},e.getTeamMembers(),A=h.getTeamShortcut().then(function(t){var a;return e.teamShortcut=null!=(a=t.data.getTeamShortcutResponse)?a.shortcutItem:void 0,t}),e.dashboardPromises.push(A)),e.participantRegistration.companyInformation&&e.participantRegistration.companyInformation.companyId)return e.companyTeams={page:1},e.getCompanyTeams=function(){var t,a;return a=e.companyTeams.page-1,t=f.getTeams("team_company_id="+e.participantRegistration.companyInformation.companyId+"&list_page_size=5&list_page_offset="+a).then(function(t){var a;return a=t.data.getTeamSearchByInfoResponse.team,angular.isArray(a)||(a=[a]),e.companyTeams.teams=a,e.companyTeams.totalNumber=t.data.getTeamSearchByInfoResponse.totalNumberResults,t}),e.dashboardPromises.push(t)},e.getCompanyTeams(),S=h.getCompanyShortcut().then(function(t){var a;return e.companyShortcut=null!=(a=t.data.getCompanyShortcutResponse)?a.shortcutItem:void 0,t}),e.dashboardPromises.push(S)}]),angular.module("trPcControllers").controller("EmailComposeViewCtrl",["$rootScope","$scope","$routeParams","$timeout","$httpParamSerializer","$uibModal","$translate","$sce","$window","TeamraiserEventService","TeamraiserEmailService","ContactService","APP_INFO",function(e,t,a,r,n,s,o,i,l,c,u,p,m){var d,g,_,f,h,y,v,b,C,T,P,S,w,R;return t.messageType=a.messageType,t.messageId=a.messageId,t.refreshContactsNav=0,t.emailPromises=[],T=function(){return t.refreshContactsNav=t.refreshContactsNav+1},t.resetEmailComposeAlerts=function(){return e.scrollToTop(),t.sendEmailError=!1,t.sendEmailSuccess=!1,t.saveDraftError=!1,t.saveDraftSuccess=!1,t.deleteDraftError=!1,t.deleteDraftSuccess=!1},(null!=(C=e.selectedContacts)?C.contacts:void 0)||p.resetSelectedContacts(),h=function(){var t,a;return t="",null!=(null!=(a=e.selectedContacts)?a.contacts:void 0)&&e.selectedContacts.contacts.length>0&&angular.forEach(e.selectedContacts.contacts,function(e){if((null!=e?e.id:void 0)&&(null!=e?e.email:void 0))return t.length>0&&(t+=", "),t+=p.getContactString(e)}),t},g=["email_rpt_show_all","email_rpt_show_never_emailed","email_rpt_show_nondonors_followup","email_rpt_show_unthanked_donors","email_rpt_show_donors","email_rpt_show_nondonors"],"true"===e.participantRegistration.previousEventParticipant&&(g.push("email_rpt_show_ly_donors"),g.push("email_rpt_show_lybunt_donors")),"-1"!==e.participantRegistration.teamId&&(g.push("email_rpt_show_teammates"),g.push("email_rpt_show_nonteammates"),"true"===e.participantRegistration.previousEventParticipant&&(g.push("email_rpt_show_ly_teammates"),g.push("email_rpt_show_ly_unreg_teammates"))),(w=function(){var a;return a=e.teamraiserConfig.defaultStationeryId,t.sendingEmail=!1,t.emailComposer={just_updated:!0,message_id:"",message_name:"",layout_id:"-1"!==a?a:"",recipients:h(),suggested_message_id:"",subject:"",prepend_salutation:!0,message_body:"",save_template_id:"",save_template:!1}})(),t.resetComposer=function(){return p.resetSelectedContacts(),t.resetEmailComposeAlerts(),w()},R=function(e){return null==e&&(e=""),e&&angular.isString(e)||(e=""),t.emailComposer.message_body=e},_=function(){var e;return e=jQuery("<div />",{html:t.emailComposer.message_body}),e.html().replace(/<\/?[A-Z]+.*?>/g,function(e){return e.toLowerCase()}).replace(/<font>/g,"<span>").replace(/<font /g,"<span ").replace(/<\/font>/g,"</span>").replace(/<b>/g,"<strong>").replace(/<b /g,"<strong ").replace(/<\/b>/g,"</strong>").replace(/<i>/g,"<em>").replace(/<i /g,"<em ").replace(/<\/i>/g,"</em>").replace(/<u>/g,'<span style="text-decoration: underline;">').replace(/<u /g,'<span style="text-decoration: underline;" ').replace(/<\/u>/g,"</span>").replace(/[\u00A0-\u9999\&]/gm,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/&#38;/g,"&").replace(/<!--[\s\S]*?-->/g,"")},(y=function(){return o(["email_template_radio_recruit_label","email_template_radio_solicit_label","email_template_radio_thanks_label","email_template_radio_other_label","email_template_radio_custom_label"]).then(function(e){return t.suggestedMessageGroupLabels={recruit:e.email_template_radio_recruit_label,solicit:e.email_template_radio_solicit_label,thanks:e.email_template_radio_thanks_label,other:e.email_template_radio_other_label,custom:e.email_template_radio_custom_label},v()},function(e){return r(y,500)})})(),v=function(){var e;return e=u.getSuggestedMessages().then(function(e){var a;return a=e.data.getSuggestedMessagesResponse.suggestedMessage,angular.isArray(a)||(a=[a]),t.suggestedMessages=[],t.suggestedMessageTemplates=[],angular.forEach(a,function(e){if("true"===e.active||"true"===e.personal){if("true"===e.personal)e.messageGroup=t.suggestedMessageGroupLabels.custom;else switch(e.messageType){case"RECRUIT":e.messageGroup=t.suggestedMessageGroupLabels.recruit;break;case"SOLICIT":e.messageGroup=t.suggestedMessageGroupLabels.solicit;break;case"THANKS":e.messageGroup=t.suggestedMessageGroupLabels.thanks;break;default:e.messageGroup=t.suggestedMessageGroupLabels.other}if(t.suggestedMessages.push(e),"true"===e.personal)return t.suggestedMessageTemplates.push(e.messageId)}}),e}),t.emailPromises.push(e)},"draft"===t.messageType&&t.messageId?u.getDraft("message_id="+t.messageId).then(function(e){var a,r,n,s,o;if(e.data.errorResponse);else if(r=null!=(n=e.data.getDraftResponse)?n.messageInfo:void 0)return t.emailComposer.message_id=t.messageId,(null!=(s=r.messageName)?s.match("&amp;"):void 0)&&(r.messageName=r.messageName.replace("&amp;","&")),(null!=(o=r.subject)?o.match("&amp;"):void 0)&&(r.subject=r.subject.replace("&amp;","&")),angular.isString(r.messageName)?t.emailComposer.message_name=r.messageName:t.emailComposer.message_name=r.subject,t.emailComposer.subject=r.subject,t.emailComposer.prepend_salutation="true"===r.prependsalutation,a=r.messageBody,R(a)}):"copy"===t.messageType&&t.messageId?u.getSentMessage("message_id="+t.messageId).then(function(e){var a,r,n,s,o;if(e.data.errorResponse);else if(r=null!=(n=e.data.getSentMessageResponse)?n.messageInfo:void 0)return(null!=(s=r.messageName)?s.match("&amp;"):void 0)&&(r.messageName=r.messageName.replace("&amp;","&")),(null!=(o=r.subject)?o.match("&amp;"):void 0)&&(r.subject=r.subject.replace("&amp;","&")),t.messageId="",t.emailComposer.message_id="",t.emailComposer.message_name=r.messageName,t.emailComposer.subject=r.subject,t.emailComposer.prepend_salutation="true"===r.prependsalutation,a=r.messageBody,R(a)}):"group"===t.messageType&&t.messageId&&g.indexOf(-1!==t.messageId)&&(p.resetSelectedContacts(),t.getGroupRecipientsPage=0,t.getGroupRecipients=function(){var e;return e=p.getTeamraiserAddressBookContacts("tr_ab_filter="+t.messageId+"&skip_groups=true&list_page_size=200&list_page_offset="+t.getGroupRecipientsPage).then(function(e){var a,r;return r=e.data.getTeamraiserAddressBookContactsResponse.totalNumberResults,a=e.data.getTeamraiserAddressBookContactsResponse.addressBookContact,angular.isArray(a)||(a=[a]),angular.forEach(a,function(e){if(null!=e)return p.addToSelectedContacts(e)}),r>p.getNumSelectedContacts()?(t.getGroupRecipientsPage=t.getGroupRecipientsPage+1,t.getGroupRecipients()):(t.messageId="",w()),e}),t.emailPromises.push(e)},t.getGroupRecipients()),b=c.getEventDataParameter("edp_type=boolean&edp_name=F2F_CENTER_TAF_PERSONALIZED_SALUTATION_ENABLED").then(function(a){return t.personalizedSalutationEnabled="true"===a.data.getEventDataParameterResponse.booleanValue,o("compose_salutation_hint").then(function(e){var a;return(null!=e?e.match(/\([^]*\)/):void 0)?(a=e.split("("),t.composeSalutationHintLabel=a[0],t.composeSalutationWhatsThis=a[1].split(")")[0]):(t.composeSalutationHintLabel=e,t.composeSalutationWhatsThis=null)},function(e){return t.composeSalutationHintLabel="Include personalized greeting",t.composeSalutationWhatsThis="What's this?"}),t.personalizedSalutationHintUrl="http://help.convio.net/site/PageServer?s_site="+e.siteShortname+"&pagename=WhatsThis_TAFPersonalizedGreeting",a}),t.emailPromises.push(b),t.loadSuggestedMessage=function(){var e;return t.resetEmailComposeAlerts(),""===(e=t.emailComposer.suggested_message_id)||null===e?w():u.getSuggestedMessage("message_id="+e).then(function(e){var a,r,n;return w(),r=null!=(n=e.data.getSuggestedMessageResponse)?n.messageInfo:void 0,t.emailComposer.suggested_message_id=r.messageId,t.emailComposer.subject=r.subject,t.suggestedMessageTemplates.indexOf(r.messageId)>-1?t.emailComposer.save_template_id=r.messageId:t.emailComposer.save_template_id="",a=r.messageBody,R(a)})},t.textEditorToolbar=[["h1","h2","h3","p","bold","italics","underline"],["ul","ol","justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["insertImage","insertLink","undo","redo"]],P=function(){var e;return e=angular.copy(t.emailComposer),e.message_body=_(),e.message_name=e.subject,delete e.just_updated,delete e.suggested_message_id,delete e.save_template_id,n(e)},S=function(){var e;return e=P(),""===t.emailComposer.message_id?u.addDraft(e).then(function(e){var a,r,n,s;return(null!=(n=e.data.errorResponse)?n.message:void 0)&&t.emailComposer.save_template&&(t.saveDraftError=e.data.errorResponse.message),(a=null!=(s=e.data.addDraftResponse)?s.message:void 0)&&(T(),r=a.messageId,t.messageId=r,t.emailComposer.message_name=a.messageName,t.emailComposer.message_id=r,t.emailComposer.save_template&&(t.saveDraftSuccess=!0,t.emailComposer.suggested_message_id=r,t.emailComposer.save_template_id=r,t.emailComposer.message_id="",v())),t.emailComposer.save_template=!1,e}):u.updateDraft(e).then(function(e){var a,r,n,s,o;return"2647"===(null!=(n=e.data.errorResponse)?n.code:void 0)&&u.deleteDraft("message_id="+t.emailComposer.message_id).then(function(e){return t.emailComposer.message_id="",S()}),(null!=(s=e.data.errorResponse)?s.message:void 0)&&t.emailComposer.save_template&&(t.saveDraftError=e.data.errorResponse.message),(a=null!=(o=e.data.updateDraftResponse)?o.message:void 0)&&(r=a.messageId,t.emailComposer.save_template&&(t.saveDraftSuccess=!0,t.emailComposer.suggested_message_id=r,t.emailComposer.save_template_id=r,t.emailComposer.message_id="",v())),t.emailComposer.save_template=!1,e})},t.$watchGroup(["emailComposer.subject","emailComposer.message_body"],function(){var e,a,n;return n=t.emailComposer.subject,a=_(),e=function(){if(t.draftPollTimeout)return r.cancel(t.draftPollTimeout),delete t.draftPollTimeout},t.emailComposer.just_updated?(t.emailComposer.just_updated=!1,e()):""===n&&""===a?e():(e(),t.emailComposer.save_template=!1,S(),t.draftPollTimeout=r(S,3e3))}),t.saveAsTemplate=function(){return t.resetEmailComposeAlerts(),t.emailComposer.save_template=!0,t.emailComposer.save_template_id=t.emailComposer.message_id,t.emailComposer.message_id="",t.emailComposer.message_name=t.emailComposer.subject,S()},t.updateTemplate=function(){return t.resetEmailComposeAlerts(),t.emailComposer.save_template=!0,t.emailComposer.message_id=t.emailComposer.save_template_id,t.emailComposer.message_name=t.emailComposer.subject,S()},t.deleteTemplate=function(){var e,a;if(t.emailComposer.save_template_id)return t.resetEmailComposeAlerts(),e=t.emailComposer.save_template_id,a=u.deleteDraft("message_id="+e).then(function(e){var a,r,n;return(null!=(a=e.data)&&null!=(r=a.deleteDraftResponse)?r.messageId:void 0)?t.deleteDraftSuccess=!0:(null!=(n=e.data.errorResponse)?n.message:void 0)?t.deleteDraftError=e.data.errorResponse.message:o("message_template_delete_error_unknown").then(function(e){return t.deleteDraftError=e},function(e){return t.deleteDraftError=e}),T(),w(),v()}),t.emailPromises.push(a)},t.emailPreview={body:""},t.selectStationeryEnabled=!1,t.stationeryChoices=[],f=u.getMessageLayouts().then(function(e){var a,r;if(e.data.errorResponse);else if(a=null!=(r=e.data.getMessageLayoutsResponse)?r.layout:void 0)return angular.isArray(a)||(a=[a]),t.stationeryChoices=a,t.selectStationeryEnabled=!0}),t.emailPromises.push(f),t.selectStationery=function(){var e;return e=P(),u.previewMessage(e).then(function(e){var a;if(e.data.errorResponse);else if(!e.data.teamraiserErrorResponse)return t.emailPreview.body=i.trustAsHtml((null!=(a=e.data.getMessagePreviewResponse)?a.message:void 0)||"")}),t.emailPromises.push(selectStationeryPromise)},t.previewEmail=function(){var e,a;return t.resetEmailComposeAlerts(),a=P(),e=u.previewMessage(a).then(function(e){var a;return e.data.errorResponse?t.sendEmailError=e.data.errorResponse.message:e.data.teamraiserErrorResponse?void 0:(t.emailPreview.body=i.trustAsHtml((null!=(a=e.data.getMessagePreviewResponse)?a.message:void 0)||""),t.emailPreviewModal=s.open({scope:t,templateUrl:m.rootPath+"html/modal/emailPreview.html",size:"lg"}))}),t.emailPromises.push(e)},d=function(){return t.emailPreviewModal.close()},t.cancelEmailPreview=function(){return d()},t.sendEmail=function(){var a,r;return t.sendingEmail?t.sendingEmail=!1:(t.sendingEmail=!0,t.resetEmailComposeAlerts(),a=P(),r=u.sendMessage(a).then(function(a){var r;return d(),t.sendingEmail=!1,e.scrollToTop(),a.data.errorResponse?t.sendEmailError=a.data.errorResponse.message:a.data.teamraiserErrorResponse?void 0:(t.messageId&&(r=u.deleteDraft("message_id="+t.messageId).then(function(e){return T()}),t.emailPromises.push(r)),T(),t.sendEmailSuccess=!0,p.resetSelectedContacts(),w())}),t.emailPromises.push(r))}}]),angular.module("trPcControllers").controller("EmailContactsListViewCtrl",["$rootScope","$scope","$window","$timeout","$routeParams","$location","$httpParamSerializer","$translate","$filter","$uibModal","TeamraiserEmailService","ContactService","APP_INFO",function(e,t,a,r,n,s,o,i,l,c,u,p,m){var d,g,_,f,h,y,v,b,C,T,P,S,w;return t.filter=n.filter,t.filter&&":filter"!==t.filter||(t.filter="email_rpt_show_all"),t.refreshContactsNav=0,t.emailPromises=[],y=function(e){var a;return a=null,t.addressBookContacts.contacts.length>0&&angular.forEach(t.addressBookContacts.contacts,function(t){if(t.id===e)return a=t}),a},(null!=(T=e.selectedContacts)?T.contacts:void 0)||p.resetSelectedContacts(),t.addressBookNumPerPageOptions=[10,25,50,100,500],t.addressBookContacts={page:1,numPerPage:10,maxContacts:0,totalNumber:0,searching:!1,contacts:[],contactSearchInput:""},t.addressBookGroups=[],t.contactSearchInput="",t.allContactsSelected=!1,t.contactsSelected={all:function(e){return arguments.length?t.allContactsSelected=e:t.allContactsSelected}},t.contactsUpdated=!1,(v=function(){var e;return e=p.getTeamraiserAddressBookContacts("tr_ab_filter=email_rpt_show_all&skip_groups=true&list_page_size=10&list_page_offset=0").then(function(e){var a;return t.addressBookContacts.maxContacts=null!=(a=e.data.getTeamraiserAddressBookContactsResponse)?a.totalNumberResults:void 0,e}),t.emailPromises.push(e)})(),P=function(){return v(),t.refreshContactsNav=t.refreshContactsNav+1},t.refreshSelectedContacts=function(){return t.addressBookContacts.contacts&&t.addressBookContacts.contacts.length>0?(t.numContactsSelected=l("filter")(t.addressBookContacts.contacts,{selected:!0}).length,t.contactsSelected.all(t.numContactsSelected===t.addressBookContacts.contacts.length)):(t.numContactsSelected=0,t.contactsSelected.all(!1)),t.contactsSelected.all()},t.refreshSelectedContacts(),t.$watchGroup(["addressBookContacts.contacts","contactsUpdated"],function(){return t.refreshSelectedContacts()}),t.getContacts=function(){var e,a,r,n;return r=t.addressBookContacts.page-1,a=t.addressBookContacts.numPerPage,n="tr_ab_filter="+t.filter+"&skip_groups=true&list_page_size="+a+"&list_page_offset="+r,""!==t.contactSearchInput&&(n+="&list_filter_text="+t.contactSearchInput),e=p.getTeamraiserAddressBookContacts(n).then(function(e){var a;return a=e.data.getTeamraiserAddressBookContactsResponse.addressBookContact,angular.isArray(a)||(a=[a]),t.addressBookContacts.contacts=[],angular.forEach(a,function(e){if(e)return e.selected=p.isInSelectedContacts(e),t.addressBookContacts.contacts.push(e)}),t.addressBookContacts.totalNumber=e.data.getTeamraiserAddressBookContactsResponse.totalNumberResults,e}),t.emailPromises.push(e)},t.getContacts(),t.showDeleteGroup=!1,t.getGroups=function(){var e;return e=p.getAddressBookGroups().then(function(e){var a,r;return a=null!=(r=e.data.getAddressBookGroupsResponse)?r.group:void 0,angular.isArray(a)||(a=[a]),t.showDeleteGroup=!1,angular.forEach(a,function(e){var a;if(e&&(a="email_rpt_group_"+e.id,t.filter===a))return t.filterName=e.name,t.showDeleteGroup=!0}),t.addressBookGroups=a,e}),t.emailPromises.push(e)},(w=function(){return t.updateContactFilterNamesTimeout&&r.cancel(t.updateContactFilterNamesTimeout),"email_rpt_show_all"===t.filter?i("contacts_groups_all").then(function(e){return t.filterName=e},function(e){return t.updateContactFilterNamesTimeout=r(w,500)}):t.filter.match("email_rpt_group_")?t.getGroups():i("filter_"+t.filter).then(function(e){return t.filterName=e},function(e){return t.updateContactFilterNamesTimeout=r(w,500)})})(),t.searchContacts=function(){return t.addressBookContacts.page=1,t.getContacts(),!1},t.clearAllContactAlerts=function(){return t.clearAddContactAlerts(),t.clearImportContactsAlerts(),t.clearEditContactAlerts(),t.clearDeleteContactAlerts()},t.clearAddContactAlerts=function(){if(t.addContactError&&delete t.addContactError,t.addContactSuccess)return delete t.addContactSuccess},t.resetNewContact=function(){return t.newContact={first_name:"",last_name:"",email:""}},t.addContact=function(){return t.clearAllContactAlerts(),t.resetNewContact(),t.addContactModal=c.open({scope:t,templateUrl:m.rootPath+"html/modal/addContact.html"})},d=function(){return t.addContactModal.close()},t.cancelAddContact=function(){return t.clearAddContactAlerts(),d()},t.addNewContact=function(){var e;return t.clearAddContactAlerts(),t.newContact.email&&""!==t.newContact.email?(e=p.addAddressBookContact(o(t.newContact)).then(function(e){return e.data.errorResponse?e.data.errorResponse.message?t.addContactError=e.data.errorResponse.message:i("contact_add_failure_unknown").then(function(e){return t.addContactError=e},function(e){return t.addContactError=e}):(i("contact_add_success").then(function(e){return t.addContactSuccess=e},function(e){return t.addContactSuccess=e}),d(),P(),t.getContacts()),e}),t.emailPromises.push(e)):i("contact_add_failure_email").then(function(e){return t.addContactError=e},function(e){return t.addContactError=e})},t.resetAddContactsToGroup=function(){if(t.addContactGroupForm={groupId:"",groupName:"",errorMsg:null},0===t.addressBookGroups.length)return t.getGroups()},t.addContactsToGroup=function(){var e;return t.resetAddContactsToGroup(),e=[],angular.forEach(t.addressBookContacts.contacts,function(t){if(null!=t?t.selected:void 0)return e.push(t.id)}),t.addContactGroupForm.contactIds=e.join(","),t.addContactsToGroupModal=c.open({scope:t,templateUrl:m.rootPath+"html/modal/addContactsToGroup.html"})},t.cancelAddContactsToGroup=function(){return t.addContactsToGroupModal.close()},t.confirmAddContactsToGroup=function(){var e,a;return delete t.addContactGroupForm.errorMsg,""===t.addContactGroupForm.groupId&&""===t.addContactGroupForm.groupName?i("contact_add_to_group_warning").then(function(e){return t.addContactGroupForm.errorMsg=e},function(e){return t.addContactGroupForm.errorMsg=e}):""!==t.addContactGroupForm.groupName?(a="group_name="+encodeURIComponent(t.addContactGroupForm.groupName)+"&contact_ids="+t.addContactGroupForm.contactIds,e=p.addAddressBookGroup(a).then(function(e){return e.data.errorResponse?e.data.errorResponse.message?t.addContactGroupForm.errorMsg=e.data.errorResponse.message:i("contact_add_to_group_unknown_error").then(function(e){return t.addContactGroupForm.errorMsg=e},function(e){return t.addContactGroupForm.errorMsg=e}):(P(),t.cancelAddContactsToGroup()),e}),t.emailPromises.push(e)):(a="group_id="+t.addContactGroupForm.groupId+"&contact_ids="+t.addContactGroupForm.contactIds,e=p.addContactsToGroup(a).then(function(e){return e.data.errorResponse?e.data.errorResponse.message?t.addContactGroupForm.errorMsg=e.data.errorResponse.message:i("contact_add_to_group_unknown_error").then(function(e){return t.addContactGroupForm.errorMsg=e},function(e){return t.addContactGroupForm.errorMsg=e}):(P(),t.cancelAddContactsToGroup()),e}),t.emailPromises.push(e))},t.deleteContactGroup=function(){return delete t.deleteContactGroupError,t.deleteContactGroupId=t.filter.replace("email_rpt_group_",""),t.deleteContactGroupModal=c.open({scope:t,templateUrl:m.rootPath+"html/modal/deleteContactGroup.html"})},t.cancelDeleteContactGroup=function(){return delete t.deleteContactGroupError,delete t.deleteContactGroupId,t.deleteContactGroupModal.close()},t.confirmDeleteContactGroup=function(){var e;return e=p.deleteAddressBookGroups("group_ids="+t.deleteContactGroupId).then(function(e){return e.data.errorResponse?e.data.errorResponse.message?t.deleteContactGroupError=e.data.errorResponse.message:i("contact_delete_group_unknown_error").then(function(e){return t.deleteContactGroupError=e},function(e){return t.deleteContactGroupError=e}):(t.cancelDeleteContactGroup(),s.path("/email/contacts"))}),t.emailPromises.push(e)},t.clearImportContactsAlerts=function(){if(t.importContactsError&&delete t.importContactsError,t.importContactsSuccess)return delete t.importContactsSuccess},t.resetImportContacts=function(){return t.contactImport={step:"choose-type",import_type:"",jobEvents:[],contactsToAdd:[]},i("contact_import_consent_needed").then(function(e){return t.contactImport.jobEvents=[],t.contactImport.jobEvents.push({message:e})},function(e){return t.contactImport.jobEvents=[],t.contactImport.jobEvents.push({message:e})})},t.importContacts=function(){return t.clearAllContactAlerts(),t.resetImportContacts(),t.importContactsModal=c.open({scope:t,templateUrl:m.rootPath+"html/modal/importContacts.html"})},f=function(){return t.importContactsModal.close()},t.cancelImportContacts=function(){return t.clearImportContactsAlerts(),f()},t.chooseImportContactType=function(){var e;if((e=t.contactImport.import_type)&&""!==e)return"csv"===e?t.contactImport.step="csv-upload":(t.contactImport.step="online-consent",a.open(m.rootPath+"html/popup/address-book-import.html?import_source="+t.contactImport.import_type,"startimport","location=no,menubar=no,toolbar=no,height=400"),!1)},window.trPcContactImport={buildAddressBookImport:function(e){return p.getAddressBookImportJobStatus("import_job_id="+e).then(function(a){var r,n,s,o,i;if(a.data.errorResponse);else if(s=null!=(o=a.data.getAddressBookImportJobStatusResponse)?o.jobStatus:void 0){if("PENDING"===s)return(r=null!=(i=a.data.getAddressBookImportJobStatusResponse.events)?i.event:void 0)?(angular.isArray(r)||(r=[r]),n=[],angular.forEach(r,function(e){return n.push({message:e})}),t.updateImportJobEvents(n)):t.updateImportJobEvents(),trPcContactImport.buildAddressBookImport(e);if("SUCCESS"===s)return p.getAddressBookImportContacts("import_job_id="+e).then(function(e){var a,r,n;if(!e.data.errorResponse)return(a=null!=(n=e.data.getAddressBookImportContactsResponse)?n.contact:void 0)?(angular.isArray(a)||(a=[a]),r=[],angular.forEach(a,function(e){var t,a,n;return a=e.firstName,n=e.lastName,t=e.email,a&&!angular.isString(a)&&delete e.firstName,n&&!angular.isString(n)&&delete e.lastName,t&&!angular.isString(t)&&delete e.email,r.push(e)}),t.setContactsAvailableForImport(r)):t.setContactsAvailableForImport()})}else;})}},b=function(e){var t;return t="",e.firstName&&(t+='"'+e.firstName+'"'),t+=", ",e.lastName&&(t+='"'+e.lastName+'"'),t+=", ",e.email&&(t+='"'+e.email+'"'),t},t.updateImportJobEvents=function(e){if(e&&0!==e.length&&(t.contactImport.jobEvents=e),!t.$$phase)return t.$apply()},t.setContactsAvailableForImport=function(e){if(t.contactImport.step="contacts-available-for-import",t.contactsAvailableForImport=e||[],!t.$$phase)return t.$apply()},t.selectAllContactsToAdd=function(e){var a;return e&&e.preventDefault(),a=[],t.contactImport.contactsToAdd=[],angular.forEach(t.contactsAvailableForImport,function(e){return e.selected=!0,a.push(e),t.contactImport.contactsToAdd.push(b(e))}),t.contactsAvailableForImport=a},t.deselectAllContactsToAdd=function(e){var a;return e&&e.preventDefault(),a=[],angular.forEach(t.contactsAvailableForImport,function(e){return e.selected=!1,a.push(e)}),t.contactsAvailableForImport=a,t.contactImport.contactsToAdd=[]},t.toggleContactToAdd=function(e){var a;return-1===(a=t.contactImport.contactsToAdd.indexOf(b(e)))?t.contactImport.contactsToAdd.push(contactData):t.contactImport.contactsToAdd.splice(a,1)},t.chooseContactsToImport=function(){return t.clearImportContactsAlerts(),0===t.contactImport.contactsToAdd.length?i("addressbookimport_selectcontacts_none_selected_failure").then(function(e){return t.importContactsError=e},function(e){return t.importContactsError=e}):p.importAddressBookContacts("contacts_to_add="+encodeURIComponent(t.contactImport.contactsToAdd.join("\n"))).then(function(e){var a,r,n,s,o,i,l,c;return e.data.errorResponse?t.importContactsError=e.data.errorResponse.message:((r=null!=(s=e.data.importAddressBookContactsResponse)?s.errorContact:void 0)&&(angular.isArray(r)||(r=[r])),(n=null!=(o=e.data.importAddressBookContactsResponse)?o.potentialDuplicateContact:void 0)&&(angular.isArray(n)||(n=[n])),(a=null!=(i=e.data.importAddressBookContactsResponse)?i.duplicateContact:void 0)&&(angular.isArray(a)||(a=[a])),(c=null!=(l=e.data.importAddressBookContactsResponse)?l.savedContact:void 0)&&(angular.isArray(c)||(c=[c])),t.importContactsSuccess=!0,f(),P(),t.getContacts())})},t.uploadContactsCSV=function(){return angular.element(document).find(".js--import-contacts-csv-form").submit(),!1},t.handleContactsCSV=function(e){var a,r,n,s,o,i,l,c,u,p,m,d;if(n=jQuery(e).contents().text())if((s=jQuery.parseJSON(n)).errorResponse);else if(null!=(u=s.parseCsvContactsResponse)?u.confidenceLevel:void 0,(c=null!=(p=s.parseCsvContactsResponse)?p.proposedMapping:void 0)&&(i=Number(c.firstNameColumnIndex),l=Number(c.lastNameColumnIndex),o=Number(c.emailColumnIndex),r=null!=(m=s.parseCsvContactsResponse)&&null!=(d=m.csvDataRows)?d.csvDataRow:void 0))return angular.isArray(r)||(r=[r]),a=[],angular.forEach(r,function(e){var t,r,n,s,c;return r=e.csvValue,s=r[i],c=r[l],n=r[o],t={firstName:s,lastName:c,email:n},s&&!angular.isString(s)&&delete t.firstName,c&&!angular.isString(c)&&delete t.lastName,n&&!angular.isString(n)&&delete t.email,a.push(t)}),t.setContactsAvailableForImport(a)},t.toggleContact=function(e){var a;return a=y(e),p.isInSelectedContacts(a)?(a.selected=!1,p.removeFromSelectedContacts(a)):(a.selected=!0,p.addToSelectedContacts(a)),t.contactsUpdated=!t.contactsUpdated},t.toggleAllContacts=function(){var e;return e=t.contactsSelected.all(),angular.forEach(t.addressBookContacts.contacts,function(a){if(a.selected!==e)return t.toggleContact(a.id)}),t.contactsSelected.all(e)},t.clearEditContactAlerts=function(){if(t.editContactError&&delete t.editContactError,t.editContactSuccess)return delete t.editContactSuccess},t.selectContact=function(e){var a;return t.clearAllContactAlerts(),a=y(e),t.editContactMode=!1,t.viewContact=angular.copy(a),t.updatedContact={contact_id:a.id,first_name:a.firstName,last_name:a.lastName,email:a.email,street1:a.street1,street2:a.street2,city:a.city,state:a.state,zip:a.zip,country:a.country},t.editContactModal=c.open({scope:t,templateUrl:m.rootPath+"html/modal/editContact.html"})},_=function(){return t.editContactModal.close()},t.cancelEditContact=function(){return delete t.editContactMode,delete t.viewContact,delete t.updatedContact,t.clearEditContactAlerts(),_()},t.toggleEditContact=function(){return t.editContactMode=!t.editContactMode},t.saveUpdatedContact=function(){var a;if(t.clearEditContactAlerts(),t.updatedContact)return a=p.updateTeamraiserAddressBookContact(o(t.updatedContact)).then(function(a){return a.data.errorResponse?a.data.errorResponse.message?t.editContactError=a.data.errorResponse.message:i("contact_add_failure_unknown").then(function(e){return t.editContactError=e},function(e){return t.editContactError=e}):(i("contact_edit_success").then(function(e){return t.editContactSuccess=e},function(e){return t.editContactSuccess=translation}),_(),e.scrollToTop(),P(),t.getContacts()),a}),t.emailPromises.push(a)},t.clearDeleteContactAlerts=function(){if(t.deleteContactError&&delete t.deleteContactError,t.deleteContactSuccess)return delete t.deleteContactSuccess},g=function(){return delete t.contactsToDelete,t.deleteContactModal&&t.deleteContactModal.close(),e.scrollToTop()},S=function(){return i("contacts_warn_delete_failure_body").then(function(e){return t.deleteContactError=e},function(e){return t.deleteContactError=e}),g()},C=function(){return t.clearDeleteContactAlerts(),t.contactsToDelete?t.deleteContactModal=c.open({scope:t,templateUrl:m.rootPath+"html/modal/deleteContact.html"}):S()},t.deleteContact=function(e){return t.contactsToDelete=[],t.contactsToDelete.push(y(e)),C()},t.deleteSelectedContacts=function(){return t.contactsToDelete=angular.copy(e.selectedContacts.contacts),C()},t.cancelDeleteContact=function(){return g()},t.confirmDeleteContact=function(){var a,r;return t.contactsToDelete?(a=[],angular.forEach(t.contactsToDelete,function(e){if(e.id)return a.push(e.id)}),r=p.deleteTeamraiserAddressBookContacts("contact_ids="+a.toString()).then(function(a){return a.data.errorResponse?a.data.errorResponse.message?t.deleteContactError=a.data.errorResponse.message:i("contacts_warn_delete_failure_body").then(function(e){return t.deleteContactError=e},function(e){return t.deleteContactError=e}):i("contacts_delete_success").then(function(e){return t.deleteContactSuccess=e},function(e){return t.deleteContactSuccess=e}),p.resetSelectedContacts(),g(),e.scrollToTop(),P(),t.getContacts(),a}),t.emailPromises.push(r)):S()},t.emailSelectedContacts=function(){return s.path("/email/compose")},h="email_rpt_show_all"===t.filter?"contacts_email_all_button":"contacts_email_group_button",i(h).then(function(e){return t.emailAllButtonLabel=e},function(e){return t.emailAllButtonLabel=e}),t.emailAllContacts=function(){return s.path("/email/compose/group/"+t.filter)}}]),angular.module("trPcControllers").controller("EmailMessageListViewCtrl",["$scope","$routeParams","$location","$translate","$timeout","$uibModal","TeamraiserEmailService","APP_INFO",function(e,t,a,r,n,s,o,i){var l,c,u;return e.messageType=t.messageType,e.refreshContactsNav=0,e.emailPromises=[],e.emailMessages={page:1},e.getEmailMessages=function(){var t;return t=["draft","sentMessage"],angular.forEach(t,function(t){var a,r,n,s,i;if(e.messageType===t)return a="get"+t.charAt(0).toUpperCase()+t.slice(1)+"s",i="draft"===t?"modify_date":"log.date_sent",s="10",n=e.emailMessages.page-1,r=o[a]("list_sort_column="+i+"&list_ascending=false&list_page_size="+s+"&list_page_offset="+n).then(function(t){var r;return r=t.data[a+"Response"].messageItem,angular.isArray(r)||(r=[r]),e.emailMessages.messages=r,e.emailMessages.totalNumber=t.data[a+"Response"].totalNumberResults,t}),e.emailPromises.push(r)})},e.getEmailMessages(),(u=function(){return e.getMessageTypeTranslationsTimeout&&n.cancel(e.getMessageTypeTranslationsTimeout),r(["drafts_drafts_label","sent_sent_message_label"]).then(function(t){var a;return a={draft:t.drafts_drafts_label,sentMessage:t.sent_sent_message_label},e.messageTypeName=a[e.messageType]},function(t){return e.getMessageTypeTranslationsTimeout=n(u,500)})})(),e.selectMessage=function(t){return"draft"===e.messageType?a.path("/email/compose/draft/"+t):(o.getSentMessage("message_id="+t).then(function(t){var a,r,n;if(t.data.errorResponse);else if(a=null!=(n=t.data.getSentMessageResponse)?n.messageInfo:void 0)return r=a.recipient,angular.isArray(r)||(r=[r]),a.recipient=r,e.sentMessage=a}),e.viewSentMessageModal=s.open({scope:e,templateUrl:i.rootPath+"html/modal/viewSentMessage.html",size:"lg"}))},c=function(){return e.viewSentMessageModal.close()},e.cancelViewSentMessage=function(){return c()},e.copySentMessage=function(e){return c(),a.path("/email/compose/copy/"+e)},e.deleteMessage=function(t){return e.deleteMessageId=t,e.deleteMessageModal=s.open({scope:e,templateUrl:i.rootPath+"html/modal/deleteEmailMessage.html"})},l=function(){return delete e.deleteMessageId,e.deleteMessageModal.close()},e.cancelDeleteMessage=function(){return l()},e.confirmDeleteMessage=function(){return"draft"===e.messageType?o.deleteDraft("message_id="+e.deleteMessageId).then(function(t){return l(),e.getEmailMessages()}):o.deleteSentMessage("message_id="+e.deleteMessageId).then(function(t){return l(),e.getEmailMessages()})}}]),angular.module("trPcControllers").controller("EnterGiftsViewCtrl",["$scope","$location","$translate","$timeout","$httpParamSerializer","TeamraiserEventService","TeamraiserGiftService",function(e,t,a,r,n,s,o){var i,l,c,u,p,m,d,g,_,f;return e.enterGiftsPromises=[],_=[],"true"===e.teamraiserConfig.offlineGiftTypes.cash&&_.push({value:"cash",name:"Cash"}),"true"===e.teamraiserConfig.offlineGiftTypes.check&&_.push({value:"check",name:"Check"}),"true"===e.teamraiserConfig.offlineGiftTypes.credit&&_.push({value:"credit",name:"Credit"}),"true"===e.teamraiserConfig.offlineGiftTypes.later&&_.push({value:"later",name:"Pay Later"}),(m=function(){return e.getPaymentTypeTranslationsTimeout&&r.cancel(e.getPaymentTypeTranslationsTimeout),a(["gift_payment_type_cash","gift_payment_type_check","gift_payment_type_credit","gift_payment_type_later"]).then(function(e){return angular.forEach(_,function(t){switch(t.value){case"cash":return t.name=e.gift_payment_type_cash;case"check":return t.name=e.gift_payment_type_check;case"credit":return t.name=e.gift_payment_type_credit;case"later":return t.name=e.gift_payment_type_later}})},function(t){return e.getPaymentTypeTranslationsTimeout=r(m,500)})})(),f=new Date,l=function(){var e,t;for(t=[],g=e=1;e<=12;g=++e)t.push({name:("0"+g).slice(-2)});return t}(),i=("0"+(f.getMonth()+1).toString()).slice(-2),u=function(){var e,t,a,r;for(r=[],g=e=t=f.getFullYear(),a=f.getFullYear()+10;t<=a?e<=a:e>=a;g=t<=a?++e:--e)r.push({name:g.toString()});return r}(),c=f.getFullYear().toString(),e.egvm={giftModel:{},giftFields:[{type:"input",key:"first_name",templateOptions:{label:"First Name:",required:!0}},{type:"input",key:"last_name",templateOptions:{label:"Last Name:",required:!0}},{type:"input",key:"email",templateOptions:{label:"Email:"}},{type:"checkbox",key:"showAdditionalFields",defaultValue:!1,templateOptions:{label:"Show donor address fields"}},{type:"input",key:"street1",hideExpression:"!model.showAdditionalFields",templateOptions:{label:"Address:"}},{type:"input",key:"street2",hideExpression:"!model.showAdditionalFields",templateOptions:{label:"Address 2:"}},{type:"input",key:"city",hideExpression:"!model.showAdditionalFields",templateOptions:{label:"City:"}},{type:"input",key:"state",hideExpression:"!model.showAdditionalFields",templateOptions:{label:"State:"}},{type:"input",key:"zip",hideExpression:"!model.showAdditionalFields",templateOptions:{label:"Zip:"}},{type:"input",key:"gift_display_name",templateOptions:{label:"Recognition Name:"}},{type:"checkbox",key:"gift_display_amount",defaultValue:!0,templateOptions:{label:"Yes, display the amount of this gift."}},{type:"checkbox",key:"team_gift",defaultValue:!1,hideExpression:"model.hideTeamGiftOption",templateOptions:{label:"Record this gift on behalf of my entire team."}},{type:"input",key:"gift_amount",templateOptions:{label:"Amount:",required:!0}},{type:"select",key:"payment_type",templateOptions:{label:"Payment Type:",options:_}},{type:"input",key:"check_number",hideExpression:"model.payment_type != 'check'",templateOptions:{label:"Check Number:"}},{type:"input",key:"credit_card_number",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Credit Card Number:"}},{type:"select",key:"credit_card_month",hideExpression:"model.payment_type != 'credit'",defaultValue:i,templateOptions:{label:"Credit Card Expiration Month:",valueProp:"name",options:l}},{type:"select",key:"credit_card_year",hideExpression:"model.payment_type != 'credit'",defaultValue:c,templateOptions:{label:"Credit Card Expiration Year:",valueProp:"name",options:u}},{type:"input",key:"credit_card_verification_code",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Verification Code:"}},{type:"input",key:"billing_first_name",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Billing First Name:"}},{type:"input",key:"billing_last_name",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Billing Last Name:"}},{type:"input",key:"billing_street1",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Billing Address:"}},{type:"input",key:"billing_street2",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Billing Address 2:"}},{type:"input",key:"billing_city",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Billing City:"}},{type:"input",key:"billing_state",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Billing State:"}},{type:"input",key:"billing_zip",hideExpression:"model.payment_type != 'credit'",templateOptions:{label:"Billing Zip:"}},{type:"select",key:"gift_category_id",hideExpression:"model.hideGiftCategoriesOption",templateOptions:{label:"Gift Category:",options:[]}}]},(p=function(){return e.getFieldLabelTranslationsTimeout&&r.cancel(e.getFieldLabelTranslationsTimeout),a(["gift_first_name_label","gift_last_name_label","gift_email_label","gift_addl_options_label","gift_street1_label","gift_street2_label","gift_city_label","gift_state_label","gift_zip_label","gift_recongition_name_label","gift_display_personal_page_label","gift_record_team_gift","gift_amount_label","gift_payment_type_label","gift_check_number_label","gift_credit_card_number_label","gift_credit_expiration_date_label","gift_credit_verification_code_label","gift_billing_first_name_label","gift_billing_last_name_label","gift_billing_street1_label","gift_billing_street2_label","gift_billing_city_label","gift_billing_state_label","gift_billing_zip_label","gift_gift_category_label"]).then(function(t){return angular.forEach(e.egvm.giftFields,function(e){switch(e.key){case"first_name":e.templateOptions.label=t.gift_first_name_label;break;case"last_name":e.templateOptions.label=t.gift_last_name_label;break;case"email":e.templateOptions.label=t.gift_email_label;break;case"showAdditionalFields":e.templateOptions.label=t.gift_addl_options_label;break;case"street1":e.templateOptions.label=t.gift_street1_label;break;case"street2":e.templateOptions.label=t.gift_street2_label;break;case"city":e.templateOptions.label=t.gift_city_label;break;case"state":e.templateOptions.label=t.gift_state_label;break;case"zip":e.templateOptions.label=t.gift_zip_label;break;case"gift_display_name":e.templateOptions.label=t.gift_recongition_name_label;break;case"gift_display_amount":e.templateOptions.label=t.gift_display_personal_page_label;break;case"team_gift":e.templateOptions.label=t.gift_record_team_gift;break;case"gift_amount":e.templateOptions.label=t.gift_amount_label;break;case"payment_type":e.templateOptions.label=t.gift_payment_type_label;break;case"check_number":e.templateOptions.label=t.gift_check_number_label;break;case"credit_card_number":e.templateOptions.label=t.gift_credit_card_number_label;break;case"credit_card_month":case"credit_card_year":e.templateOptions.label=t.gift_credit_expiration_date_label;break;case"credit_card_verification_code":e.templateOptions.label=t.gift_credit_verification_code_label;break;case"billing_first_name":e.templateOptions.label=t.gift_billing_first_name_label;break;case"billing_last_name":e.templateOptions.label=t.gift_billing_last_name_label;break;case"billing_street1":e.templateOptions.label=t.gift_billing_street1_label;break;case"billing_street2":e.templateOptions.label=t.gift_billing_street2_label;break;case"billing_city":e.templateOptions.label=t.gift_billing_city_label;break;case"billing_state":e.templateOptions.label=t.gift_billing_state_label;break;case"billing_zip":e.templateOptions.label=t.gift_billing_zip_label;break;case"gift_category_id":e.templateOptions.label=t.gift_gift_category_label}return e.templateOptions.label=e.templateOptions.label.replace(/\*/gm,"")})},function(t){return e.getFieldLabelTranslationsTimeout=r(p,500)})})(),"true"===e.teamraiserConfig.showGiftCategories?(e.egvm.giftModel.hideGiftCategoriesOption=!0,d=o.getGiftCategories().then(function(t){var a,r;return a=t.data.getGiftCategoriesResponse.giftCategory,angular.isArray(a)||(a=[a]),r=[],angular.forEach(a,function(e){if(angular.isString(e.name))return r.push({value:e.id,name:e.name})}),angular.forEach(e.egvm.giftFields,function(e){if("gift_category_id"===e.key)return e.templateOptions.options=angular.copy(r)}),e.egvm.giftModel.hideGiftCategoriesOption=!1,t}),e.enterGiftsPromises.push(d)):e.egvm.giftModel.hideGiftCategoriesOption=!0,e.egvm.originalFields=angular.copy(e.egvm.giftFields),e.egvm.giftModel.hideTeamGiftOption=!("MEMBERS"===e.teamraiserConfig.offlineTeamGifts||"CAPTAINS"===e.teamraiserConfig.offlineTeamGifts&&"true"===e.participantRegistration.aTeamCaptain),e.clearGiftAlerts=function(){var t,a;if(t=(null!=(a=e.egvm.giftAlerts)?a.addGiftSuccess:void 0)&&e.egvm.giftAlerts.addGiftSuccess,e.egvm.giftAlerts={addGiftAttempt:!1,addGiftSuccess:!1,addGiftAgainAttempt:!1,addGiftAgainSuccess:!1,addGiftFailure:!1,addGiftFailureMessage:""},t)return e.cancelGiftEntry()},e.clearGiftAlerts(),e.cancelGiftEntry=function(){return t.path("/dashboard")},e.addGift=function(){var t;if(!e.egvm.giftAlerts.addGiftAttempt)return e.egvm.giftAlerts.addGiftAttempt=!0,t=o.addGift(n(e.egvm.giftModel)).then(function(t){return e.egvm.giftAlerts.addGiftAttempt=!1,t.data.errorResponse?(e.egvm.giftAlerts.addGiftFailure=!0,t.data.errorResponse.message?e.egvm.giftAlerts.addGiftFailureMessage=t.data.errorResponse.message:a("gift_submission_error").then(function(t){return e.egvm.giftAlerts.addGiftFailureMessage=t},function(t){return e.egvm.giftAlerts.addGiftFailureMessage=t})):(e.egvm.giftAlerts.addGiftAgainAttempt?e.egvm.giftAlerts.addGiftAgainSuccess=!0:e.egvm.giftAlerts.addGiftSuccess=!0,e.egvm.giftOptions.resetModel()),window.scrollTo(0,0),t}),e.enterGiftsPromises.push(t)},e.addGiftClearForm=function(){return e.egvm.giftAlerts.addGiftAgainAttempt=!0,e.addGift()}}]),angular.module("trPcControllers").controller("EventOptionsViewCtrl",["$scope","$translate","$uibModal","TeamraiserRegistrationService","TeamraiserTeamService","TeamraiserCompanyService","APP_INFO",function(e,t,a,r,n,s,o){var i,l,c;return e.eventOptionsPromises=[],e.refreshRegistration=function(){var t;return t=r.getRegistration().then(function(e){return c(),l()}),e.eventOptionsPromises.push(t)},e.refreshRegistration(),e.personalPrivacySettings={isPrivate:"true"===e.participantRegistration.privatePage,privacySetting:"",updatePrivacySuccess:!1,updatePrivacyFailure:!1,updatePrivacyFailureMessage:""},c=function(){return"true"===e.participantRegistration.privatePage?e.personalPrivacySettings.privacySetting="private":e.personalPrivacySettings.privacySetting="public"},e.updatePrivacyOptions=function(){var t,a;return e.resetPrivacyAlerts(),t="is_private=","private"===e.personalPrivacySettings.privacySetting?t+="true":t+="false",a=r.updatePersonalPagePrivacy(t).then(function(t){var a,r;return(null!=(a=t.data.updatePersonalPagePrivacyResponse)?a.privatePage:void 0)?(e.personalPrivacySettings.isPrivate="true"===t.data.updatePersonalPagePrivacyResponse.privatePage,e.personalPrivacySettings.updatePrivacySuccess=!0,e.refreshRegistration()):(e.personalPrivacySettings.updatePrivacyFailure=!0,e.personalPrivacySettings.updatePrivacyFailureMessage=null!=(r=t.data.errorResponse)?r.message:void 0),t}),e.eventOptionsPromises.push(a)},e.resetPrivacyAlerts=function(){return e.personalPrivacySettings.updatePrivacySuccess=!1,e.personalPrivacySettings.updatePrivacyFailure=!1,e.personalPrivacySettings.updatePrivacyFailureMessage=""},e.displayNameSettings={showDisplayNamePanel:!1,standardRegAllowed:"true"===e.teamraiserConfig.standardRegistrationAllowed||!0===e.teamraiserConfig.standardRegistrationAllowed,anonymousRegAllowed:"true"===e.teamraiserConfig.anonymousRegistrationAllowed||!0===e.teamraiserConfig.anonymousRegistrationAllowed,screennameRegAllowed:"true"===e.teamraiserConfig.screennameRegistrationAllowed||!0===e.teamraiserConfig.screennameRegistrationAllowed,updateScreennameSuccess:!1,updateScreennameFailure:!1,updateScreennameFailureMessage:"",currentSelection:null,currentScreenname:null},(e.displayNameSettings.standardRegAllowed&&(e.displayNameSettings.anonymousRegAllowed||e.displayNameSettings.screennameRegAllowed)||e.displayNameSettings.anonymousRegAllowed&&e.displayNameSettings.screennameRegAllowed)&&(e.displayNameSettings.showDisplayNamePanel=!0),l=function(){return"true"===e.participantRegistration.anonymous||!0===e.participantRegistration.anonymous?(e.displayNameSettings.currentSelection="anonymous",e.displayNameSettings.currentScreenname=null):e.participantRegistration.screenname?(e.displayNameSettings.currentSelection="screenname",e.displayNameSettings.currentScreenname=e.participantRegistration.screenname):(e.displayNameSettings.currentSelection="standard",e.displayNameSettings.currentScreenname=null)},e.updateDisplayNameSetting=function(){var t,a;switch(e.resetScreennameAlerts(),t="",e.displayNameSettings.currentSelection){case"anonymous":t="anonymous_registration=true";break;case"screenname":t="screenname="+encodeURIComponent(e.displayNameSettings.currentScreenname);break;case"standard":t="standard_registration=true";break;default:t="standard_registration=true"}return a=r.updateRegistration(t).then(function(t){return t.data.errorResponse?(e.displayNameSettings.updateScreennameFailure=!0,e.displayNameSettings.updateScreennameFailureMessage=t.data.errorResponse.message):(e.displayNameSettings.updateScreennameSuccess=!0,e.refreshRegistration()),t}),e.eventOptionsPromises.push(a)},e.resetScreennameAlerts=function(){return e.displayNameSettings.updateScreennameSuccess=!1,e.displayNameSettings.updateScreennameFailure=!1,e.displayNameSettings.updateScreennameFailureMessage=""},e.manageCompanyMembership={showManageCompanyPanel:!1,newCompanyEntryAllowed:!1,companyOptions:[],currentCompanyName:"",currentSelection:null!=(i=e.participantRegistration.companyInformation)?i.companyId:void 0,newCompanyEntry:"",updateCompanySuccess:!1,updateCompanyFailure:!1,updateCompanyFailureMessage:""},e.getCompanyList=function(){var a;return a=s.getCompanyList().then(function(a){var r,n;return a.data.errorResponse?e.manageCompanyMembership.showManageCompanyPanel=!1:(n=a.data.getCompanyListResponse.companyItem,angular.isArray(n)||(n=[n]),e.manageCompanyMembership.companyOptions=n,(null!=(r=e.participantRegistration.companyInformation)?r.companyId:void 0)?angular.forEach(n,function(t){if(e.participantRegistration.companyInformation.companyId===t.companyId)return e.manageCompanyMembership.currentCompanyName=t.companyName}):t("dashboard_company_null_label").then(function(t){return e.manageCompanyMembership.currentCompanyName=t},function(t){return e.manageCompanyMembership.currentCompanyName=t})),a}),e.eventOptionsPromises.push(a)},e.openCompanySelection=function(){return e.manageCompanyMembership.newCompanyEntry="",e.companySelectionModal=a.open({scope:e,templateUrl:o.rootPath+"html/modal/editCompanyAssociation.html"})},e.resetCompanyAlerts=function(t){if(e.manageCompanyMembership.updateCompanySuccess=!1,e.manageCompanyMembership.updateCompanyFailure=!1,e.manageCompanyMembership.updateCompanyFailureMessage="",t)return e.companySelectionModal.close()},e.initCompanyInfo=function(){return"-1"===e.participantRegistration.teamId&&"true"===e.teamraiserConfig.participantCompanyAssociationAllowed?(e.manageCompanyMembership.showManageCompanyPanel=!0,"true"===e.teamraiserConfig.participantCompanyNewEntryAllowed&&(e.manageCompanyMembership.newCompanyEntryAllowed=!0)):"-1"!==e.participantRegistration.teamId&&"true"===e.participantRegistration.aTeamCaptain&&"true"===e.teamraiserConfig.companyAssociationAllowed?(e.manageCompanyMembership.showManageCompanyPanel=!0,"true"===e.teamraiserConfig.companyNewEntryAllowed&&(e.manageCompanyMembership.newCompanyEntryAllowed=!0)):(e.manageCompanyMembership.showManageCompanyPanel=!1,e.manageCompanyMembership.newCompanyEntryAllowed=!1),e.manageCompanyMembership.showManageCompanyPanel&&e.getCompanyList(),e.resetCompanyAlerts(!1)},e.initCompanyInfo(),e.updateCompanyAssociation=function(){var t,a;return t=e.manageCompanyMembership.newCompanyEntry.length>0?"company_name="+encodeURIComponent(e.manageCompanyMembership.newCompanyEntry):"company_id="+e.manageCompanyMembership.currentSelection,a="-1"===e.participantRegistration.teamId?r.updateRegistration(t).then(function(t){return e.updateCompanyAssociationResponse(t)}):n.updateTeamInformation(t).then(function(t){return e.updateCompanyAssociationResponse(t)}),e.eventOptionsPromises.push(a)},e.updateCompanyAssociationResponse=function(a){var r,n,s,o;return a.data.errorResponse?(e.manageCompanyMembership.updateCompanyFailure=!0,a.data.errorResponse.message?e.manageCompanyMembership.updateCompanyFailureMessage=a.data.errorResponse.message:t("company_selection_update_unexpected_error").then(function(t){return e.manageCompanyMembership.updateCompanyFailureMessage=t},function(t){return e.manageCompanyMembership.updateCompanyFailureMessage=t})):(e.manageCompanyMembership.updateCompanySuccess=!0,e.participantRegistration.companyInformation?e.participantRegistration.companyInformation.companyId=(null!=(r=a.data.updateTeamInformationResponse)?r.companyId:void 0)||(null!=(n=a.data.updateRegistrationResponse)?n.companyId:void 0):e.participantRegistration.companyInformation={companyId:(null!=(s=a.data.updateTeamInformationResponse)?s.companyId:void 0)||(null!=(o=a.data.updateRegistrationResponse)?o.companyId:void 0)},e.getCompanyList()),a},e.manageTeamMembership={showManageTeamMembership:"-1"===e.participantRegistration.teamId||"true"!==e.participantRegistration.aTeamCaptain,currentTeamId:e.participantRegistration.teamId,manageTeamMembershipAlerts:[],currentSelection:"stay",joinTeamAlerts:[],joinTeamSearch:{teamName:"",teamCompany:"",captainFirst:"",captainLast:"",searchPage:1,searchString:"",searchSubmitted:!1,searchResults:[],searchTotalNumber:0,joinTeamId:"",joinTeamPassword:""}},e.searchTeams=function(){var a,r;return e.clearAllTeamMembershipAlerts(),e.manageTeamMembership.joinTeamSearch.searchSubmitted&&(e.manageTeamMembership.joinTeamSearch.searchPage=1,e.manageTeamMembership.joinTeamSearch.searchString="",e.manageTeamMembership.joinTeamSearch.searchSubmitted=!1,e.manageTeamMembership.joinTeamSearch.searchResults=[],e.manageTeamMembership.joinTeamSearch.searchTotalNumber=0),r="",e.manageTeamMembership.joinTeamSearch.teamName.length>0&&(r+="&team_name="+e.manageTeamMembership.joinTeamSearch.teamName),e.manageTeamMembership.joinTeamSearch.teamCompany.length>0&&(r+="&team_company="+e.manageTeamMembership.joinTeamSearch.teamCompany),(e.manageTeamMembership.joinTeamSearch.captainFirst.length>0||e.manageTeamMembership.joinTeamSearch.captainLast.length>0)&&(a=e.manageTeamMembership.joinTeamSearch.captainFirst.length+e.manageTeamMembership.joinTeamSearch.captainLast.length,0===r.length&&a<3?t("manage_membership_search_captain_name_min_chars").then(function(t){return e.manageTeamMembership.joinTeamAlerts.push({type:"danger",msg:t})},function(t){return e.manageTeamMembership.joinTeamAlerts.push({type:"danger",msg:t})}):(e.manageTeamMembership.joinTeamSearch.captainFirst.length>0&&(r+="&first_name="+e.manageTeamMembership.joinTeamSearch.captainFirst),e.manageTeamMembership.joinTeamSearch.captainLast.length>0&&(r+="&last_name="+e.manageTeamMembership.joinTeamSearch.captainLast))),0===r.length?t("manage_membership_search_failure").then(function(t){return e.manageTeamMembership.joinTeamAlerts.push({type:"danger",msg:t})},function(t){return e.manageTeamMembership.joinTeamAlerts.push({type:"danger",msg:t})}):(e.manageTeamMembership.joinTeamSearch.searchString=r,e.searchTeamsPage())},e.searchTeamsPage=function(){var a,r;return a="include_cross_event=false&full_search=false",a+="&list_sort_column=name&list_ascending=true",a+="&list_page_size=5&list_page_offset="+(e.manageTeamMembership.joinTeamSearch.searchPage-1),a+=e.manageTeamMembership.joinTeamSearch.searchString,e.manageTeamMembership.joinTeamSearch.searchSubmitted=!0,r=n.getTeams(a).then(function(a){var r;return a.data.errorResponse?a.data.errorResponse.message?e.manageTeamMembership.joinTeamAlerts.push({type:"danger",msg:a.data.errorResponse.message}):t("manage_membership_search_failure").then(function(t){return e.manageTeamMembership.joinTeamAlerts.push({type:"danger",msg:t})},function(t){return e.manageTeamMembership.joinTeamAlerts.push({type:"danger",msg:t})}):(r=a.data.getTeamSearchByInfoResponse.team,angular.isArray(r)||(r=[r]),e.manageTeamMembership.joinTeamSearch.searchResults=r,e.manageTeamMembership.joinTeamSearch.searchTotalNumber=Number(a.data.getTeamSearchByInfoResponse.totalNumberResults)),a}),e.eventOptionsPromises.push(r)},e.joinTeam=function(r,s,i){var l,c;return!s||"true"!==s||i&&0!==i.length?(l="team_id="+r,s&&"true"===s&&i&&i.length>0&&(l+="&team_password="+i),c=n.joinTeam(l).then(function(a){var r,n,s,o,i;return a.data.errorResponse?a.data.errorResponse.message?e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"danger",msg:a.data.errorResponse.message}):t("manage_membership_join_team_unexpected_error").then(function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"danger",msg:t})},function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"danger",msg:t})}):(i=null!=(r=a.data.joinTeamResponse)&&null!=(n=r.team)?n.name:void 0,t("manage_membership_join_team_success").then(function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"success",msg:t+i+"."})},function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"success",msg:t+i+"."})}),e.manageTeamMembership.joinTeamSearch.joinTeamId="",e.manageTeamMembership.joinTeamSearch.joinTeamPassword="",e.manageTeamMembership.currentTeamId=null!=(s=a.data.joinTeamResponse)&&null!=(o=s.team)?o.id:void 0,e.manageTeamMembership.currentSelection="stay",e.refreshRegistration()),a}),e.eventOptionsPromises.push(c)):(e.manageTeamMembership.joinTeamSearch.joinTeamId=r,e.manageTeamMembership.joinTeamSearch.joinTeamPassword="",e.joinTeamPasswordModal=a.open({scope:e,templateUrl:o.rootPath+"html/modal/joinTeamPassword.html"}))},e.leaveTeam=function(){return n.leaveTeam().then(function(a){return a.data.errorResponse?a.data.errorResponse.message?e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"danger",msg:a.data.errorResponse.message}):t("manage_membership_leave_team_unexpected_error").then(function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"danger",msg:t})},function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"danger",msg:t})}):(t("manage_membership_leave_team_success").then(function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"success",msg:t})},function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.push({type:"success",msg:t})}),e.manageTeamMembership.currentTeamId="-1",e.manageTeamMembership.currentSelection="stay",e.refreshRegistration()),a}),e.eventOptionsPromises.push(joinTeamPromise)},e.cancelJoinTeamPassword=function(){return e.manageTeamMembership.joinTeamSearch.joinTeamId="",e.manageTeamMembership.joinTeamSearch.joinTeamPassword="",e.joinTeamPasswordModal.close()},e.clearTeamMembershipAlert=function(t){return e.manageTeamMembership.manageTeamMembershipAlerts.splice(t,1)},e.clearJoinTeamAlert=function(t){return e.manageTeamMembership.joinTeamAlerts.splice(t,1)},e.clearAllTeamMembershipAlerts=function(){return e.manageTeamMembership.manageTeamMembershipAlerts=[],e.manageTeamMembership.joinTeamAlerts=[]}}]),angular.module("trPcControllers").controller("LoginCtrl",["$rootScope","$scope","$route","$httpParamSerializer","$translate","$window","AuthService",function(e,t,a,r,n,s,o){var i;return t.resetLoginAlerts=function(){if(t.loginError)return delete t.loginError},i=function(){return n("error_invalid_username_or_password").then(function(e){return t.loginError=e},function(e){return t.loginError=e})},t.consLogin={user_name:"",password:""},t.submitLogin=function(){return""===t.consLogin.user_name||""===t.consLogin.password?i():(t.resetLoginAlerts(),o.login(r(t.consLogin)).then(function(r){var n,o,l;return(o=r.data.errorResponse)?["200","201","202","204"].indexOf(o.code)?i():t.loginError=o.message:(n=r.data.loginResponse.cons_id,Number(n)!==Number(e.consId)?s.location.reload():(e.loginModal&&(e.loginModal.close(),delete e.loginModal),angular.element(document).find(".modal").click(),e.consId=(null!=(l=r.data.loginResponse)?l.cons_id:void 0)||-1,delete e.authToken,a.reload()))}))}}]),angular.module("trPcControllers").controller("NgPcMainCtrl",["$rootScope","$location","LocaleService",function(e,t,a){return e.$location=t,e.baseUrl=t.absUrl().split("#")[0],a.setLocale(e.locale),e.changeLocale=function(){return a.setLocale()}}]),angular.module("trPcControllers").controller("SurveyQuestionsViewCtrl",["$scope","$translate","$httpParamSerializer","TeamraiserSurveyResponseService",function(e,t,a,r){return e.surveyResponsePromises=[],e.sqvm={surveyFields:[],surveyModel:{},updateSurveyResponses:e.updateSurveyResponses},e.getSurveyResponses=function(){var t;return t=r.getSurveyResponses().then(function(t){var a;return a=t.data.getSurveyResponsesResponse.responses,angular.isArray(a)||(a=[a]),angular.forEach(a,function(t){var a,r;if(t){switch(r={type:null,key:"question_"+t.questionId,data:{dataType:t.questionType},templateOptions:{label:t.questionText,required:"true"===t.questionRequired}},t.questionType){case"Caption":r.type="caption";break;case"DateQuestion":r.type="datepicker";break;case"NumericValue":r.type="input";break;case"ShortTextValue":r.type="input",r.templateOptions.maxChars=40;break;case"TextValue":r.type="input",r.templateOptions.maxChars=255;break;case"LargeTextValue":r.type="textarea";break;case"TrueFalse":case"YesNo":case"MultiSingle":r.type="select";break;case"ComboChoice":r.type="typeahead";break;case"Categories":case"MultiMulti":r.type="checkbox";break;case"MultiSingleRadio":case"RatingScale":r.type="radio";break;case"Captcha":r.type="captcha";break;case"HiddenInterests":case"HiddenTextValue":case"HiddenTrueFalse":r.type="hidden";break;default:r.type="input"}return"true"===t.isHidden&&(r.type="hidden"),t.questionAnswer&&(r.templateOptions.options=[],angular.forEach(t.questionAnswer,function(e){return r.templateOptions.options.push({name:e.label,value:e.value})})),e.sqvm.surveyFields.push(r),"User Provided No Response"===t.responseValue?e.sqvm.surveyModel[r.key]=null:"datepicker"===r.type?(a=t.responseValue.split("-"),e.sqvm.surveyModel[r.key]=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]),parseInt(a[3].split(":")[0]),parseInt(a[3].split(":")[1]))):"checkbox"===r.type?e.sqvm.surveyModel[r.key]="true"===t.responseValue:e.sqvm.surveyModel[r.key]=t.responseValue}}),e.sqvm.originalFields=angular.copy(e.sqvm.surveyFields),t}),e.surveyResponsePromises.push(t)},e.getSurveyResponses(),e.updateSurveyResponses=function(n){var s;return n.preventDefault(),s=r.updateSurveyResponses(a(e.sqvm.surveyModel)).then(function(a){return a.data.errorResponse?(e.updateSurveySuccess=!1,e.updateSurveyFailure=!0,a.data.errorResponse.message?e.updateSurveyFailureMessage=a.data.errorResponse.message:t("survey_save_failure").then(function(t){return e.updateSurveyFailureMessage=t},function(t){return e.updateSurveyFailureMessage=t})):(e.updateSurveySuccess=!0,e.updateSurveyFailure=!1,e.sqvm.surveyOptions.updateInitialValue()),a}),e.surveyResponsePromises.push(s)},e.resetSurveyAlerts=function(){return e.updateSurveySuccess=!1,e.updateSurveyFailure=!1,e.updateSurveyFailureMessage=""},e.resetSurveyAlerts()}]),angular.module("trPcApp").directive("badgeList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/badgeList.html",restrict:"E",replace:!0,scope:{badges:"="}}}]),angular.module("trPcApp").directive("companyTeamList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/companyTeamList.html",restrict:"E",replace:!0,scope:{teams:"="}}}]),angular.module("trPcApp").directive("contactList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/contactList.html",restrict:"E",replace:!0,scope:{contacts:"=",toggleContact:"=",selectContact:"=",deleteContact:"="}}}]),angular.module("trPcApp").directive("emailContactsNav",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/emailContactsNav.html",restrict:"E",scope:{refreshMessages:"=",refreshContacts:"="},controller:["$scope","$rootScope","$routeParams","$translate","$timeout","TeamraiserEmailService","ContactService",function(e,t,a,r,n,s,o){var i,l,c,u,p,m,d,g,_,f;return e.filter=a.filter||"no_filter_defined",e.messageType=a.messageType||"no_message_type",e.baseUrl=t.baseUrl,e.emailPromises=[],e.messageCounts={},g=["draft","sentMessage"],(m=function(){return angular.forEach(g,function(t){var a,r;return a="get"+t.charAt(0).toUpperCase()+t.slice(1)+"s",r=s[a]("list_page_size=1").then(function(r){return e.messageCounts[t+"s"]=r.data[a+"Response"].totalNumberResults,r}),e.emailPromises.push(r)})})(),(p=function(){var t;if(e.getFilterTranslationTimeout&&n.cancel(e.getFilterTranslationTimeout),"no_filter_defined"===e.filter){switch(e.messageType){case"draft":t="drafts_drafts_label";break;case"sentMessage":t="sent_sent_messages_label";break;default:t="compose_message_label"}return r(t).then(function(t){return e.filterName=t},function(t){return e.getFilterTranslationTimeout=n(p,500)})}})(),e.contactGroups=[],i=["email_rpt_show_all","email_rpt_show_never_emailed","email_rpt_show_nondonors_followup","email_rpt_show_unthanked_donors","email_rpt_show_donors","email_rpt_show_nondonors"],"true"===t.participantRegistration.previousEventParticipant&&(i.push("email_rpt_show_ly_donors"),i.push("email_rpt_show_lybunt_donors")),"-1"!==t.participantRegistration.teamId&&(i.push("email_rpt_show_teammates"),i.push("email_rpt_show_nonteammates"),"true"===t.participantRegistration.previousEventParticipant&&(i.push("email_rpt_show_ly_teammates"),i.push("email_rpt_show_ly_unreg_teammates"))),f=function(t,a){return angular.forEach(e.contactGroups,function(r){if(t===r.id&&(r.name=a),t===e.filter)return e.filterName=a})},_=function(t,a){return angular.forEach(e.contactGroups,function(e){if(t===e.id)return e.num=a||"0"})},c=function(){var t;return e.getContactGroupTranslationsTimeout&&n.cancel(e.getContactGroupTranslationsTimeout),t=["contacts_groups_all","filter_email_rpt_show_never_emailed","filter_email_rpt_show_nondonors_followup","filter_email_rpt_show_unthanked_donors","filter_email_rpt_show_donors","filter_email_rpt_show_nondonors","filter_email_rpt_show_ly_donors","filter_email_rpt_show_lybunt_donors","filter_email_rpt_show_teammates","filter_email_rpt_show_nonteammates","filter_email_rpt_show_ly_teammates","filter_email_rpt_show_ly_unreg_teammates"],r(t).then(function(e){return f("email_rpt_show_all",e.contacts_groups_all),f("email_rpt_show_never_emailed",e.filter_email_rpt_show_never_emailed),f("email_rpt_show_nondonors_followup",e.filter_email_rpt_show_nondonors_followup),f("email_rpt_show_unthanked_donors",e.filter_email_rpt_show_unthanked_donors),f("email_rpt_show_donors",e.filter_email_rpt_show_donors),f("email_rpt_show_nondonors",e.filter_email_rpt_show_nondonors),f("email_rpt_show_ly_donors",e.filter_email_rpt_show_ly_donors),f("email_rpt_show_lybunt_donors",e.filter_email_rpt_show_lybunt_donors),f("email_rpt_show_teammates",e.filter_email_rpt_show_teammates),f("email_rpt_show_nonteammates",e.filter_email_rpt_show_nonteammates),f("email_rpt_show_ly_teammates",e.filter_email_rpt_show_ly_teammates),f("email_rpt_show_ly_unreg_teammates",e.filter_email_rpt_show_ly_unreg_teammates)},function(t){return e.getContactGroupTranslationsTimeout=n(c,500)})},l=function(){return angular.forEach(i,function(t){var a;return a=o.getTeamraiserAddressBookContacts("tr_ab_filter="+t+"&skip_groups=true").then(function(e){return _(t,e.data.getTeamraiserAddressBookContactsResponse.totalNumberResults),e}),e.emailPromises.push(a)})},u=function(){var a;return a=o.getAddressBookGroups("count_contacts=true").then(function(a){var r,n;return r=null!=(n=a.data.getAddressBookGroupsResponse)?n.group:void 0,angular.isArray(r)||(r=[r]),angular.forEach(r,function(a){var r;if(a&&(r="email_rpt_group_"+a.id,e.contactGroups.push({id:r,url:t.baseUrl+"#/email/contacts/"+r+"/list",num:a.contactsCount,name:a.name}),r===e.filter))return e.filterName=a.name}),a}),e.emailPromises.push(a)},(d=function(){return e.contactGroups=[],angular.forEach(i,function(a){return e.contactGroups.push({id:a,url:t.baseUrl+"#/email/contacts/"+a+"/list",num:"0",name:""})}),c(),l(),u()})(),e.$watch("refreshContacts",function(e,t){if(e&&e!==t)return d()}),e.$watch("refreshMessages",function(e,t){if(e&&e!==t)return m()})}]}}]),angular.module("trPcApp").directive("emailMessageList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/emailMessageList.html",restrict:"E",replace:!0,scope:{messages:"=",selectMessage:"=",deleteMessage:"="}}}]),angular.module("trPcApp").directive("giftList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/giftList.html",restrict:"E",replace:!0,scope:{gifts:"=",showActions:"=",acknowledgeGift:"&",thankDonor:"&",deleteGift:"&",giftActionLabels:"="}}}]),angular.module("trPcApp").directive("iframeLoaded",function(){return{restrict:"A",scope:{iframeLoaded:"="},link:function(e,t,a){return t.on("load",function(){return e.iframeLoaded(t)})}}}),angular.module("trPcApp").directive("importContactsList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/importContactsList.html",restrict:"E",replace:!0,scope:{contacts:"=",toggleContact:"="}}}]),angular.module("trPcApp").directive("newsFeedList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/newsFeedList.html",restrict:"E",replace:!0,scope:{items:"="}}}]),angular.module("trPcApp").directive("recentActivityList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/recentActivityList.html",restrict:"E",replace:!0,scope:{records:"="}}}]),angular.module("trPcApp").directive("socialShare",["$interval","SocialShareService",function(e,t){return{template:'<div class="janrainSocialPlaceholder"></div>',restrict:"E",replace:!0,scope:{sharePage:"<"},link:function(a,r,n){return a.sharePage?t.activateJanrain(r,a.sharePage):a.shareWatch=e(function(){if(a.sharePage&&a.sharePage.match("http"))return t.activateJanrain(r,a.sharePage),e.cancel(a.shareWatch)},1e3)}}}]),angular.module("trPcApp").directive("teamMemberList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/teamMemberList.html",restrict:"E",replace:!0,scope:{members:"="}}}]),angular.module("trPcApp").directive("teamsList",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/teamsList.html",restrict:"E",transclude:!0,replace:!0,scope:{teams:"=",joinTeam:"&"}}}]),angular.module("trPcApp").directive("topNav",["APP_INFO",function(e){return{templateUrl:e.rootPath+"html/directive/topNav.html",restrict:"E",replace:!0}}])}).call(this);